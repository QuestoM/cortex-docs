
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Enterprise AI Agent SDK - Brain-inspired, goal-driven, on-prem ready">
      
      
      
        <link rel="canonical" href="https://docs.cortex-ai.com/neuroscience_implementation_spec/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Neuroscience Pattern Implementation Specification - corteX Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#neuroscience-pattern-implementation-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="corteX Documentation" class="md-header__button md-logo" aria-label="corteX Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            corteX Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Neuroscience Pattern Implementation Specification
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tutorials/" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../concepts/" class="md-tabs__link">
          
  
  
    
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guides/" class="md-tabs__link">
          
  
  
    
  
  How-To Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../enterprise/" class="md-tabs__link">
          
  
  
    
  
  Enterprise

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../reference/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="corteX Documentation" class="md-nav__button md-logo" aria-label="corteX Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    corteX Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../getting-started/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Your First Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/adding-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streaming Responses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../tutorials/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/support-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Customer Support Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/code-review-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Review Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/research-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Research Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/multi-provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Provider Failover
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy to Production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../concepts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/engine-v2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agentic Engine Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../concepts/brain/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    The Brain Engine
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    The Brain Engine
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/weights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synaptic Weights
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/goal-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/dual-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dual-Process Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/prediction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prediction & Surprise
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/feedback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/plasticity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plasticity & Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/adaptation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sensory Adaptation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/brain-llm-bridge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Brain-LLM Bridge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/brain/neurollama-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NeuroLlama Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../concepts/context/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Context & Memory
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Context & Memory
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/context/context-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cortical Context Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/context/memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Fabric
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/context/cross-modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cross-Modal Association
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cognitive Systems
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cognitive Systems
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/cognitive-context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cognitive Context Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/agent-intelligence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Intelligence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/goal-intelligence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal Intelligence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/model-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intelligent Model Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/anti-drift/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anti-Drift System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../concepts/advanced/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Advanced Subsystems
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Subsystems
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attention & Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/columns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cortical Columns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/resource-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resource Allocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/concept-graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept Graphs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calibration & Metacognition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/modulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Targeted Modulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/reorganization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Map Reorganization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/population/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Population Estimation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Component Simulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/structured-output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structured Output
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/content-prediction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content-Aware Predictions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/game-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Game Theory Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/context-summarizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Summarization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/advanced/semantic-scorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../concepts/interop/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Interoperability
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Interoperability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/interop/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP - Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/interop/a2a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A2A - Agent-to-Agent Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/llm-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/tool-reputation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Reputation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    How-To Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    How-To Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LLM Providers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    LLM Providers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/providers/openai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect to OpenAI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/providers/gemini/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect to Google Gemini
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/providers/anthropic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect to Anthropic Claude
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/providers/local-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Local Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/providers/switching-providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Switch Between Providers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/config/weight-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tune Agent Weights
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/config/context-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure Context Profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/config/temperature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Control Temperature &amp; Creativity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/config/brain-parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Configure Brain-to-LLM Parameter Mapping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/config/inference-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Configure Inference-Time Brain Hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/tools/custom-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create Custom Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/tools/tool-reputation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manage Tool Reputation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Interop
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Interop
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/interop/mcp-servers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connect to MCP Servers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/interop/a2a-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Delegate Tasks to A2A Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/advanced/what-if-simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run What-If Simulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/advanced/modulation-overrides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Override with Targeted Modulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/advanced/weight-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persist Weights Across Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/advanced/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitor Your Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../enterprise/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Enterprise
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Enterprise
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/multi-tenant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Tenant Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security & Isolation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Safety Controls
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audit Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compliance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/compliance-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compliance Overview (SOC 2 + GDPR)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/licensing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Licensing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/on-prem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    On-Premises Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise/updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Updates & Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Public API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Public API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/session/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Session API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Response &amp; Configuration API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Modules
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Modules
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/core/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EventBus API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/core/contracts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contracts API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/core/registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugin Registry API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Engine Modules
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Engine Modules
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_1" >
        
          
          <label class="md-nav__link" for="__nav_7_4_1" id="__nav_7_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Brain Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Brain Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/weights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weight Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/goal-tracker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal Tracker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/feedback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/prediction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prediction Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/plasticity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plasticity Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/adaptation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adaptation Filter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/game-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Game Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cortical Context Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/bayesian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bayesian Mathematics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calibration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/columns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Columns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/cross-modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cross-Modal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/resource-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resource Map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/proactive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proactive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/population/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Population
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_2" >
        
          
          <label class="md-nav__link" for="__nav_7_4_2" id="__nav_7_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Brain-LLM Bridge
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Brain-LLM Bridge
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/brain-state-injector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Brain State Injector API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/parameter-resolver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Brain Parameter Resolver API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/inference-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inference Hooks (Layer 2) API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/context-summarizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Summarizer API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_3" >
        
          
          <label class="md-nav__link" for="__nav_7_4_3" id="__nav_7_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agent Intelligence
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agent Intelligence
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/model-mosaic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Mosaic API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/speculative-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Speculative Executor API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/decision-log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Log API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/progress-estimator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Progress Estimator API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/ab-test-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A/B Test Manager API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/provider-health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provider Health Monitor API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4_4" id="__nav_7_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agentic Engine
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agentic Engine
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/agent-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Loop API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/context-compiler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Compiler API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/planner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Planning Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/reflection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reflection Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/recovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recovery Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interaction Manager API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/policy-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/sub-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sub-Agent Manager API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_5" >
        
          
          <label class="md-nav__link" for="__nav_7_4_5" id="__nav_7_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Goal System
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Goal System
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/goal-tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal Tree API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/goal-dna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal DNA API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/goal-reminder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Goal Reminder Injector API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_6" >
        
          
          <label class="md-nav__link" for="__nav_7_4_6" id="__nav_7_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Anti-Drift
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Anti-Drift
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/drift-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Drift Detection Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/loop-detector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loop Detector API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/adaptive-budget/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adaptive Budget Engine API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_7" >
        
          
          <label class="md-nav__link" for="__nav_7_4_7" id="__nav_7_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced Engine
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Engine
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/simulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Component Simulator API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/reorganization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cortical Map Reorganizer API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/modulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Targeted Modulator API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/structured-output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structured Output API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/content-prediction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Prediction API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/engine/semantic-scorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Importance Scorer API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    NeuroLlama
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    NeuroLlama
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/neurollama/neurollama-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NeuroLlama API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Enterprise
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Enterprise
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Config API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/licensing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License Manager API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Update Manager API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/consent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consent Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/gdpr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GDPR Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/retention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retention Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Profiling Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/explainability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Explainability Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/enterprise/data-residency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Residency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tools/decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Decorator API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tools/executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Executor API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LLM Layer
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    LLM Layer
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/router/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Router API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Base API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/openai-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenAI Provider API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/gemini-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gemini Provider API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/anthropic-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anthropic Provider API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/classifier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cognitive Classifier API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/cost-tracker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cost Tracker API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Registry API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/llm/resilience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resilience Primitives API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          <label class="md-nav__link" for="__nav_7_9" id="__nav_7_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cognitive Context
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cognitive Context
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/entanglement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Entanglement Graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/pyramid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Pyramid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/predictive-loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Predictive Pre-Loader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/crystallizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Crystallizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/active-forgetting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Active Forgetting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/versioner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Versioner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/density-optimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Density Optimizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/context-quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Quality Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/state-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State File Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cognitive/cognitive-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cognitive Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <label class="md-nav__link" for="__nav_7_10" id="__nav_7_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Key Vault
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/capabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Capability Set
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/attenuation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Risk Attenuator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Classifier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compliance Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/audit-logger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audit Logger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/pii-tokenizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PII Tokenizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security/tenant-encryption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant Encryption
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_11" >
        
          
          <label class="md-nav__link" for="__nav_7_11" id="__nav_7_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tenancy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tenancy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tenancy/manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tenancy/dna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant DNA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tenancy/quota/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quota Tracker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_12" >
        
          
          <label class="md-nav__link" for="__nav_7_12" id="__nav_7_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Observability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/observability/tracer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Tracer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/observability/cost-predictor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cost Predictor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/observability/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metrics Collector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/observability/audit-stream/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audit Stream
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../reference/interop/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Interop
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_13" id="__nav_7_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Interop
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/mcp-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/mcp-tool-bridge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Tool Bridge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/mcp-transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Transport
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/mcp-resource-bridge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Resource Bridge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/a2a-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A2A Client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/a2a-agent-card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A2A Agent Card
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/interop/a2a-task-bridge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A2A Task Bridge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cortex-brain-inspired-ai-agent-sdk-remaining-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        corteX Brain-Inspired AI Agent SDK - Remaining Patterns
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p0-proactive-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        P0: Proactive Prediction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P0: Proactive Prediction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#neuroscience-basis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neuroscience Basis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-cortexenginepredictionpy-enhancement" class="md-nav__link">
    <span class="md-ellipsis">
      
        File: corteX/engine/prediction.py (Enhancement)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Structures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-conversationtrajectorymodel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: ConversationTrajectoryModel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-predictionchaincache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: PredictionChainCache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-prewarmingscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: PreWarmingScheduler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-proactivepredictionengine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: ProactivePredictionEngine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-scenarios-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Scenarios (10+)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edge-cases-and-failure-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Edge Cases and Failure Modes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p1-cross-modal-association" class="md-nav__link">
    <span class="md-ellipsis">
      
        P1: Cross-Modal Association
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P1: Cross-Modal Association">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#neuroscience-basis_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neuroscience Basis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-cortexengineassociationpy-new-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        File: corteX/engine/association.py (New File)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Structures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-domainsimilaritymap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: DomainSimilarityMap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-crossmodalassociator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: CrossModalAssociator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-points_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-scenarios-10_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Scenarios (10+)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edge-cases-and-failure-modes_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Edge Cases and Failure Modes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p1-continuous-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      
        P1: Continuous Calibration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P1: Continuous Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#neuroscience-basis_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neuroscience Basis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-overview_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-cortexenginecalibrationpy-new-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        File: corteX/engine/calibration.py (New File)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Structures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-sessionstartcalibrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: SessionStartCalibrator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-driftdetector" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: DriftDetector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-continuouscalibrationengine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class: ContinuousCalibrationEngine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-points_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-scenarios-10_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Scenarios (10+)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edge-cases-and-failure-modes_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Edge Cases and Failure Modes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p2-functional-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        P2: Functional Columns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P2: Functional Columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-cortexenginecolumnspy-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        File: corteX/engine/columns.py (Future)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p2-attentional-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        P2: Attentional Filter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P2: Attentional Filter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-design_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-cortexengineattentionpy-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        File: corteX/engine/attention.py (Future)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-pattern-interactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Pattern Interactions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Pattern Interactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-proactive-prediction-feeds-adaptation" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Proactive Prediction feeds Adaptation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cross-modal-association-interacts-with-population-coding" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Cross-Modal Association interacts with Population Coding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-continuous-calibration-affects-plasticity" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Continuous Calibration affects Plasticity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-prediction-calibration-feedback-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Prediction-Calibration Feedback Loop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-adaptation-feeds-cross-modal-association" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Adaptation feeds Cross-Modal Association
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-brain-pattern-proposals" class="md-nav__link">
    <span class="md-ellipsis">
      
        New Brain Pattern Proposals
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="New Brain Pattern Proposals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposal-1-neuromodulatory-system-dopamine-norepinephrine-serotonin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposal 1: Neuromodulatory System (Dopamine / Norepinephrine / Serotonin)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposal-2-inhibitory-interneurons-lateral-inhibition-winner-take-all" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposal 2: Inhibitory Interneurons (Lateral Inhibition / Winner-Take-All)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposal-3-place-cells-grid-cells-cognitive-map-of-task-space" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposal 3: Place Cells / Grid Cells (Cognitive Map of Task Space)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposal-4-mirror-neuron-system-learning-from-observation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposal 4: Mirror Neuron System (Learning from Observation)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Roadmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Roadmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-p0-proactive-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: P0 Proactive Prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-p1-cross-modal-association" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: P1 Cross-Modal Association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-p1-continuous-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: P1 Continuous Calibration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-cross-pattern-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Cross-Pattern Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-p2-patterns-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: P2 Patterns (Future)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mathematical-model-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mathematical Model Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mathematical Model Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proactive-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proactive Prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-modal-association" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Modal Association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Continuous Calibration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-existing-engine-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Appendix: Existing Engine Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="neuroscience-pattern-implementation-specification">Neuroscience Pattern Implementation Specification<a class="headerlink" href="#neuroscience-pattern-implementation-specification" title="Permanent link">&para;</a></h1>
<h2 id="cortex-brain-inspired-ai-agent-sdk-remaining-patterns">corteX Brain-Inspired AI Agent SDK - Remaining Patterns<a class="headerlink" href="#cortex-brain-inspired-ai-agent-sdk-remaining-patterns" title="Permanent link">&para;</a></h2>
<p><strong>Status</strong>: Implementation Specification
<strong>Author</strong>: Research Agent
<strong>Date</strong>: 2026-02-09
<strong>Source Material</strong>: Prof. Idan Segev, Hebrew University - "Mashav Moach: From Synapses to Free Will"
<strong>Codebase Version</strong>: Current engine/ modules (weights, prediction, plasticity, feedback, adaptation, population, goal_tracker, memory)</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#p0-proactive-prediction">P0: Proactive Prediction</a></li>
<li><a href="#p1-cross-modal-association">P1: Cross-Modal Association</a></li>
<li><a href="#p1-continuous-calibration">P1: Continuous Calibration</a></li>
<li><a href="#p2-functional-columns">P2: Functional Columns (High-Level)</a></li>
<li><a href="#p2-attentional-filter">P2: Attentional Filter (High-Level)</a></li>
<li><a href="#cross-pattern-interactions">Cross-Pattern Interactions</a></li>
<li><a href="#new-brain-pattern-proposals">New Brain Pattern Proposals</a></li>
</ol>
<hr />
<h2 id="p0-proactive-prediction">P0: Proactive Prediction<a class="headerlink" href="#p0-proactive-prediction" title="Permanent link">&para;</a></h2>
<h3 id="neuroscience-basis">Neuroscience Basis<a class="headerlink" href="#neuroscience-basis" title="Permanent link">&para;</a></h3>
<blockquote>
<p>"The goalkeeper imagines what will happen in the next moment. He fantasizes about the future.
He imagines what's going to happen. This machine constantly imagines. Sometimes it succeeds
in imagining well, and if not, it updates and works like this constantly - it predicts, and
updates when its prediction doesn't match reality." - Prof. Idan Segev, Lecture 4</p>
</blockquote>
<p>The current <code>PredictionEngine</code> in <code>corteX/engine/prediction.py</code> is <strong>reactive</strong>: it predicts
the outcome of an action <em>about to be taken</em>, then compares after execution. This is analogous
to the cerebellum predicting the sensory consequences of a motor command.</p>
<p>But the cortex does something far more powerful: it predicts <strong>what stimulus will arrive next</strong>,
before any action is even planned. The goalkeeper does not wait for the ball to be kicked; he
predicts the trajectory <em>before</em> the kick occurs. This is proactive prediction -- forecasting
the next user message, the next task type, the next tool needed, <em>before the user sends anything</em>.</p>
<h3 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ProactivePredictionEngine
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  |
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  +-- ConversationTrajectoryModel (n-gram + recency-weighted Markov chain)
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  |
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  +-- PredictionChainCache (sequence pattern store: A-&gt;B-&gt;? = C)
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  |
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>  +-- PreWarmingScheduler (async background pre-loading of tools/context/models)
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>  |
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>  +-- IntegrationBridge (connects to existing PredictionEngine for unified API)
</code></pre></div>
<h3 id="file-cortexenginepredictionpy-enhancement">File: <code>corteX/engine/prediction.py</code> (Enhancement)<a class="headerlink" href="#file-cortexenginepredictionpy-enhancement" title="Permanent link">&para;</a></h3>
<p>All new code extends the existing <code>prediction.py</code> file. The existing <code>PredictionEngine</code> class
is preserved. A new <code>ProactivePredictionEngine</code> class wraps it and adds proactive capabilities.</p>
<h3 id="data-structures">Data Structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConversationTurn</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A single turn in the conversation, featurized for prediction.&quot;&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">turn_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">task_type</span><span class="p">:</span> <span class="nb">str</span>              <span class="c1"># coding, debugging, research, conversation, etc.</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">tools_used</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">model_used</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">topic_hash</span><span class="p">:</span> <span class="nb">str</span>             <span class="c1"># Coarse hash of topic for sequence matching</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">complexity</span><span class="p">:</span> <span class="nb">float</span>           <span class="c1"># 0.0 to 1.0</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">user_message_length</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="nd">@dataclass</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">NextTurnPrediction</span><span class="p">:</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Prediction of what the user will ask next.&quot;&quot;&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="n">predicted_task_type</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span>                   <span class="c1"># 0.0 to 1.0</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="n">predicted_tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>          <span class="c1"># Tools likely needed</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="n">predicted_model</span><span class="p">:</span> <span class="nb">str</span>                <span class="c1"># Best model for predicted task</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    <span class="n">predicted_complexity</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># Expected complexity</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="n">prediction_basis</span><span class="p">:</span> <span class="nb">str</span>               <span class="c1"># Why this prediction (chain match, frequency, etc.)</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="n">pre_warm_actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>         <span class="c1"># Specific pre-warming actions to take</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="n">chain_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># If matched a known chain</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="nd">@dataclass</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="k">class</span><span class="w"> </span><span class="nc">PredictionChain</span><span class="p">:</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A learned sequence pattern: A -&gt; B -&gt; C.&quot;&quot;&quot;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>    <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>    <span class="n">sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>                 <span class="c1"># Sequence of task_type hashes</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>    <span class="n">next_predicted</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># The predicted next element</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>    <span class="n">occurrences</span><span class="p">:</span> <span class="nb">int</span>                    <span class="c1"># How many times this chain was observed</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    <span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span>                 <span class="c1"># How often the prediction was correct</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>    <span class="n">last_seen</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>    <span class="n">decay_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>          <span class="c1"># Recency weighting (decays over time)</span>
</code></pre></div>
<h3 id="class-conversationtrajectorymodel">Class: ConversationTrajectoryModel<a class="headerlink" href="#class-conversationtrajectorymodel" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConversationTrajectoryModel</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="sd">    Models conversation as a Markov chain with variable-length memory.</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="sd">    Uses n-gram analysis (n=1,2,3) to predict the next turn&#39;s task type.</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="sd">    The model maintains transition probabilities:</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="sd">      P(task_type_next | task_type_current) -- unigram</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="sd">      P(task_type_next | task_type_prev, task_type_current) -- bigram</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="sd">      P(task_type_next | t_prev2, t_prev1, t_current) -- trigram</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="sd">    Higher-order n-grams are weighted more when they have sufficient data,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="sd">    falling back to lower-order when sparse.</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">max_history</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        <span class="n">unigram_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>        <span class="n">bigram_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>        <span class="n">trigram_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        <span class="n">recency_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>     <span class="c1"># Weight of each older turn</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="p">):</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConversationTurn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_history</span> <span class="o">=</span> <span class="n">max_history</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">unigram_weight</span><span class="p">,</span> <span class="n">bigram_weight</span><span class="p">,</span> <span class="n">trigram_weight</span><span class="p">)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_recency_decay</span> <span class="o">=</span> <span class="n">recency_decay</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="c1"># Transition counts: key = (prev_states_tuple,) -&gt; {next_state: count}</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unigram_transitions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_bigram_transitions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigram_transitions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_turn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn</span><span class="p">:</span> <span class="n">ConversationTurn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a completed turn and update transition probabilities.&quot;&quot;&quot;</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_history</span><span class="p">:</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_history</span><span class="p">:]</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>        <span class="n">task</span> <span class="o">=</span> <span class="n">turn</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>        <span class="c1"># Update unigram: P(next | current)</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_unigram_transitions</span><span class="p">[</span><span class="n">prev</span><span class="p">][</span><span class="n">task</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>        <span class="c1"># Update bigram: P(next | prev, current)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>            <span class="n">prev2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>            <span class="n">prev1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_bigram_transitions</span><span class="p">[(</span><span class="n">prev2</span><span class="p">,</span> <span class="n">prev1</span><span class="p">)][</span><span class="n">task</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a>        <span class="c1"># Update trigram: P(next | prev2, prev1, current)</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>            <span class="n">prev3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>            <span class="n">prev2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>            <span class="n">prev1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigram_transitions</span><span class="p">[(</span><span class="n">prev3</span><span class="p">,</span> <span class="n">prev2</span><span class="p">,</span> <span class="n">prev1</span><span class="p">)][</span><span class="n">task</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict_next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="sd">        Predict the next task type with probabilities.</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="sd">        Returns sorted list of (task_type, probability) pairs.</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="sd">        Mathematical model:</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a><span class="sd">          P(next) = w1 * P_unigram(next) + w2 * P_bigram(next) + w3 * P_trigram(next)</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a><span class="sd">        Where each P_n is normalized from raw counts with recency weighting.</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a><span class="sd">        If an n-gram has no data, its weight is redistributed to lower-order models.</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">:</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a>            <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;conversation&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a>        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a>        <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a>        <span class="c1"># Unigram prediction</span>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a>        <span class="n">uni_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_counts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unigram_transitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="p">{}))</span>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a>        <span class="c1"># Bigram prediction</span>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a>        <span class="n">bi_probs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a>            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a>            <span class="n">bi_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_counts</span><span class="p">(</span>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_bigram_transitions</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">prev</span><span class="p">,</span> <span class="n">current</span><span class="p">),</span> <span class="p">{})</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a>            <span class="p">)</span>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>        <span class="c1"># Trigram prediction</span>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a>        <span class="n">tri_probs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a>            <span class="n">prev2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>            <span class="n">prev1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>            <span class="n">tri_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_counts</span><span class="p">(</span>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_trigram_transitions</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">prev2</span><span class="p">,</span> <span class="n">prev1</span><span class="p">,</span> <span class="n">current</span><span class="p">),</span> <span class="p">{})</span>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a>            <span class="p">)</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a>        <span class="c1"># Redistribute weights if higher-order n-grams are empty</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>        <span class="n">effective_w1</span><span class="p">,</span> <span class="n">effective_w2</span><span class="p">,</span> <span class="n">effective_w3</span> <span class="o">=</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tri_probs</span><span class="p">:</span>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>            <span class="n">effective_w2</span> <span class="o">+=</span> <span class="n">effective_w3</span>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>            <span class="n">effective_w3</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">bi_probs</span><span class="p">:</span>
<a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a>            <span class="n">effective_w1</span> <span class="o">+=</span> <span class="n">effective_w2</span>
<a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>            <span class="n">effective_w2</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>
<a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>        <span class="n">total_weight</span> <span class="o">=</span> <span class="n">effective_w1</span> <span class="o">+</span> <span class="n">effective_w2</span> <span class="o">+</span> <span class="n">effective_w3</span>
<a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>        <span class="k">if</span> <span class="n">total_weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>            <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;conversation&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
<a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>
<a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>        <span class="c1"># Combine</span>
<a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>        <span class="n">all_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">uni_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">bi_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">tri_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a>        <span class="n">combined</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">all_types</span><span class="p">:</span>
<a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>            <span class="n">combined</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>                <span class="n">effective_w1</span> <span class="o">*</span> <span class="n">uni_probs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>                <span class="o">+</span> <span class="n">effective_w2</span> <span class="o">*</span> <span class="n">bi_probs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>                <span class="o">+</span> <span class="n">effective_w3</span> <span class="o">*</span> <span class="n">tri_probs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>            <span class="p">)</span> <span class="o">/</span> <span class="n">total_weight</span>
<a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>
<a id="__codelineno-2-120" name="__codelineno-2-120" href="#__codelineno-2-120"></a>        <span class="c1"># Sort by probability descending</span>
<a id="__codelineno-2-121" name="__codelineno-2-121" href="#__codelineno-2-121"></a>        <span class="n">ranked</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-122" name="__codelineno-2-122" href="#__codelineno-2-122"></a>        <span class="k">return</span> <span class="n">ranked</span>
<a id="__codelineno-2-123" name="__codelineno-2-123" href="#__codelineno-2-123"></a>
<a id="__codelineno-2-124" name="__codelineno-2-124" href="#__codelineno-2-124"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-2-125" name="__codelineno-2-125" href="#__codelineno-2-125"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize raw counts to probabilities with Laplace smoothing.&quot;&quot;&quot;</span>
<a id="__codelineno-2-126" name="__codelineno-2-126" href="#__codelineno-2-126"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">counts</span><span class="p">:</span>
<a id="__codelineno-2-127" name="__codelineno-2-127" href="#__codelineno-2-127"></a>            <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-2-128" name="__codelineno-2-128" href="#__codelineno-2-128"></a>        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># Laplace smoothing</span>
<a id="__codelineno-2-129" name="__codelineno-2-129" href="#__codelineno-2-129"></a>        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-2-130" name="__codelineno-2-130" href="#__codelineno-2-130"></a>
<a id="__codelineno-2-131" name="__codelineno-2-131" href="#__codelineno-2-131"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_trajectory_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-2-132" name="__codelineno-2-132" href="#__codelineno-2-132"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-133" name="__codelineno-2-133" href="#__codelineno-2-133"></a><span class="sd">        Compute the entropy of the predicted distribution.</span>
<a id="__codelineno-2-134" name="__codelineno-2-134" href="#__codelineno-2-134"></a><span class="sd">        Low entropy = high confidence (predictable user).</span>
<a id="__codelineno-2-135" name="__codelineno-2-135" href="#__codelineno-2-135"></a><span class="sd">        High entropy = uncertain (unpredictable user).</span>
<a id="__codelineno-2-136" name="__codelineno-2-136" href="#__codelineno-2-136"></a>
<a id="__codelineno-2-137" name="__codelineno-2-137" href="#__codelineno-2-137"></a><span class="sd">        H = -sum(p * log2(p)) for all predicted task types</span>
<a id="__codelineno-2-138" name="__codelineno-2-138" href="#__codelineno-2-138"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-2-139" name="__codelineno-2-139" href="#__codelineno-2-139"></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_next</span><span class="p">()</span>
<a id="__codelineno-2-140" name="__codelineno-2-140" href="#__codelineno-2-140"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">predictions</span><span class="p">:</span>
<a id="__codelineno-2-141" name="__codelineno-2-141" href="#__codelineno-2-141"></a>            <span class="k">return</span> <span class="mf">1.0</span>
<a id="__codelineno-2-142" name="__codelineno-2-142" href="#__codelineno-2-142"></a>        <span class="n">entropy</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-2-143" name="__codelineno-2-143" href="#__codelineno-2-143"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">:</span>
<a id="__codelineno-2-144" name="__codelineno-2-144" href="#__codelineno-2-144"></a>            <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-145" name="__codelineno-2-145" href="#__codelineno-2-145"></a>                <span class="n">entropy</span> <span class="o">-=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
<a id="__codelineno-2-146" name="__codelineno-2-146" href="#__codelineno-2-146"></a>        <span class="k">return</span> <span class="n">entropy</span>
</code></pre></div>
<h3 id="class-predictionchaincache">Class: PredictionChainCache<a class="headerlink" href="#class-predictionchaincache" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PredictionChainCache</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="sd">    Stores and matches learned conversation chains.</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="sd">    A chain is a sequence like: [coding, debugging, testing] -&gt; documentation.</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="sd">    If the user&#39;s last 3 turns were coding -&gt; debugging -&gt; testing,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="sd">    and this chain has been seen 5 times before with documentation</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="sd">    following 4/5 times, then predict &quot;documentation&quot; with 80% confidence.</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="sd">    Chain matching uses variable-length prefix matching:</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="sd">    - Try to match the longest chain first (most specific)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="sd">    - Fall back to shorter chains if no long match</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="sd">    Mathematical model:</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="sd">      confidence(chain) = occurrences / (occurrences + k) * success_rate * decay_factor</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="sd">      where k = 3 (pseudocount for Bayesian smoothing)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        <span class="n">max_chain_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="n">min_occurrences</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        <span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>        <span class="n">decay_halflife_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">24.0</span><span class="p">,</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>    <span class="p">):</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PredictionChain</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span> <span class="o">=</span> <span class="n">max_chain_length</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_min_occurrences</span> <span class="o">=</span> <span class="n">min_occurrences</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_chains</span> <span class="o">=</span> <span class="n">max_chains</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_halflife</span> <span class="o">=</span> <span class="n">decay_halflife_hours</span> <span class="o">*</span> <span class="mi">3600</span>  <span class="c1"># Convert to seconds</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="sd">        Record a completed sequence and extract all sub-chains.</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="sd">        For [A, B, C, D], extracts:</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="sd">          [A] -&gt; B, [A,B] -&gt; C, [A,B,C] -&gt; D</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="sd">          [B] -&gt; C, [B,C] -&gt; D</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="sd">          [C] -&gt; D</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>        <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">task_types</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span> <span class="o">-</span> <span class="n">length</span><span class="p">):</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>                <span class="n">prefix</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">task_types</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="n">length</span><span class="p">])</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>                <span class="n">next_item</span> <span class="o">=</span> <span class="n">task_types</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>                <span class="n">chain_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">next_item</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>                <span class="k">if</span> <span class="n">chain_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">:</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>                    <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">chain_key</span><span class="p">]</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>                    <span class="n">chain</span><span class="o">.</span><span class="n">occurrences</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>                    <span class="n">chain</span><span class="o">.</span><span class="n">last_seen</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">chain_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">PredictionChain</span><span class="p">(</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>                        <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_key</span><span class="p">,</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>                        <span class="n">sequence</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>                        <span class="n">next_predicted</span><span class="o">=</span><span class="n">next_item</span><span class="p">,</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>                        <span class="n">occurrences</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>                        <span class="n">success_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>                        <span class="n">last_seen</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>                    <span class="p">)</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>        <span class="c1"># Prune if over capacity</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_chains</span><span class="p">:</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span><span class="p">()</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recent_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">PredictionChain</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="sd">        Find the best matching chain for the recent task sequence.</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a><span class="sd">        Tries longest prefix first, then shorter.</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="sd">        Returns (chain, confidence) or None if no match.</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>        <span class="n">best_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">PredictionChain</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>        <span class="n">best_score</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>        <span class="c1"># Try progressively shorter prefixes</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>        <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recent_types</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">recent_types</span><span class="p">[</span><span class="o">-</span><span class="n">length</span><span class="p">:])</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>            <span class="c1"># Find all chains matching this prefix</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>                <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span> <span class="o">==</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">chain</span><span class="o">.</span><span class="n">occurrences</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_occurrences</span><span class="p">:</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>                    <span class="c1"># Compute confidence with time decay</span>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>                    <span class="n">age_seconds</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">chain</span><span class="o">.</span><span class="n">last_seen</span>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>                    <span class="n">decay</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.693</span> <span class="o">*</span> <span class="n">age_seconds</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_halflife</span><span class="p">)</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>                    <span class="n">chain</span><span class="o">.</span><span class="n">decay_factor</span> <span class="o">=</span> <span class="n">decay</span>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>                    <span class="c1"># Bayesian smoothed confidence</span>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Pseudocount</span>
<a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>                    <span class="n">confidence</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>                        <span class="n">chain</span><span class="o">.</span><span class="n">occurrences</span> <span class="o">/</span> <span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">occurrences</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>                        <span class="o">*</span> <span class="n">chain</span><span class="o">.</span><span class="n">success_rate</span>
<a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>                        <span class="o">*</span> <span class="n">decay</span>
<a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>                    <span class="p">)</span>
<a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>
<a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>                    <span class="c1"># Longer chains get a bonus (more specific = more trustworthy)</span>
<a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>                    <span class="n">length_bonus</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">length</span>
<a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>                    <span class="n">score</span> <span class="o">=</span> <span class="n">confidence</span> <span class="o">*</span> <span class="n">length_bonus</span>
<a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>
<a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>                    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
<a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>                        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
<a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>                        <span class="n">best_match</span> <span class="o">=</span> <span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
<a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a>
<a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>        <span class="k">return</span> <span class="n">best_match</span>
<a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>
<a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">was_correct</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-106" name="__codelineno-3-106" href="#__codelineno-3-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the accuracy of a chain prediction after verification.&quot;&quot;&quot;</span>
<a id="__codelineno-3-107" name="__codelineno-3-107" href="#__codelineno-3-107"></a>        <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chain_id</span><span class="p">)</span>
<a id="__codelineno-3-108" name="__codelineno-3-108" href="#__codelineno-3-108"></a>        <span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
<a id="__codelineno-3-109" name="__codelineno-3-109" href="#__codelineno-3-109"></a>            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># EMA factor</span>
<a id="__codelineno-3-110" name="__codelineno-3-110" href="#__codelineno-3-110"></a>            <span class="n">actual</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">was_correct</span> <span class="k">else</span> <span class="mf">0.0</span>
<a id="__codelineno-3-111" name="__codelineno-3-111" href="#__codelineno-3-111"></a>            <span class="n">chain</span><span class="o">.</span><span class="n">success_rate</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">success_rate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">actual</span> <span class="o">*</span> <span class="n">alpha</span>
<a id="__codelineno-3-112" name="__codelineno-3-112" href="#__codelineno-3-112"></a>
<a id="__codelineno-3-113" name="__codelineno-3-113" href="#__codelineno-3-113"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_prune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-114" name="__codelineno-3-114" href="#__codelineno-3-114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove least useful chains (low occurrence, old, low success).&quot;&quot;&quot;</span>
<a id="__codelineno-3-115" name="__codelineno-3-115" href="#__codelineno-3-115"></a>        <span class="n">scored</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-116" name="__codelineno-3-116" href="#__codelineno-3-116"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-3-117" name="__codelineno-3-117" href="#__codelineno-3-117"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-3-118" name="__codelineno-3-118" href="#__codelineno-3-118"></a>            <span class="n">age</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">chain</span><span class="o">.</span><span class="n">last_seen</span>
<a id="__codelineno-3-119" name="__codelineno-3-119" href="#__codelineno-3-119"></a>            <span class="n">score</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">occurrences</span> <span class="o">*</span> <span class="n">chain</span><span class="o">.</span><span class="n">success_rate</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">age</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_halflife</span><span class="p">)</span>
<a id="__codelineno-3-120" name="__codelineno-3-120" href="#__codelineno-3-120"></a>            <span class="n">scored</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>
<a id="__codelineno-3-121" name="__codelineno-3-121" href="#__codelineno-3-121"></a>        <span class="n">scored</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-3-122" name="__codelineno-3-122" href="#__codelineno-3-122"></a>        <span class="c1"># Remove bottom 20%</span>
<a id="__codelineno-3-123" name="__codelineno-3-123" href="#__codelineno-3-123"></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scored</span><span class="p">)</span> <span class="o">//</span> <span class="mi">5</span>
<a id="__codelineno-3-124" name="__codelineno-3-124" href="#__codelineno-3-124"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">scored</span><span class="p">[:</span><span class="n">to_remove</span><span class="p">]:</span>
<a id="__codelineno-3-125" name="__codelineno-3-125" href="#__codelineno-3-125"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div>
<h3 id="class-prewarmingscheduler">Class: PreWarmingScheduler<a class="headerlink" href="#class-prewarmingscheduler" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PreWarmingScheduler</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="sd">    Executes pre-warming actions based on proactive predictions.</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="sd">    Pre-warming actions include:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="sd">    - Pre-selecting the model (avoiding cold-start latency)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="sd">    - Pre-loading tool definitions for predicted tools</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="sd">    - Pre-fetching relevant memory context</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="sd">    - Pre-building system prompts for predicted task types</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="sd">    All pre-warming is advisory: if the prediction is wrong,</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="sd">    the pre-warmed resources are simply discarded.</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="sd">    Brain analogy: Motor cortex preparing a movement before</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="sd">    the conscious decision to move. Readiness potential (Bereitschaftspotential)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="sd">    precedes conscious awareness of the decision by ~500ms.</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MemoryFabric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="n">memory</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_warming_in_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pre_warm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">NextTurnPrediction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="sd">        Execute pre-warming based on a prediction.</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="sd">        Returns a dict of pre-warmed resources.</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_warming_in_progress</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>        <span class="n">warmed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>            <span class="c1"># 1. Pre-select model</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>            <span class="n">warmed</span><span class="p">[</span><span class="s2">&quot;predicted_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predicted_model</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>            <span class="n">warmed</span><span class="p">[</span><span class="s2">&quot;predicted_task_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predicted_task_type</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>            <span class="c1"># 2. Pre-fetch memory context for predicted topic</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">:</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>                <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="o">.</span><span class="n">get_relevant_context</span><span class="p">(</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>                    <span class="n">prediction</span><span class="o">.</span><span class="n">predicted_task_type</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">5</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>                <span class="p">)</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>                <span class="n">warmed</span><span class="p">[</span><span class="s2">&quot;pre_fetched_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>            <span class="c1"># 3. Record predicted tools for fast loading</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>            <span class="n">warmed</span><span class="p">[</span><span class="s2">&quot;predicted_tools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predicted_tools</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>            <span class="c1"># 4. Record confidence for downstream use</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>            <span class="n">warmed</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">confidence</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmed</span> <span class="o">=</span> <span class="n">warmed</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_warming_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>        <span class="k">return</span> <span class="n">warmed</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_pre_warmed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve pre-warmed resources. Returns empty if nothing pre-warmed.&quot;&quot;&quot;</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmed</span><span class="p">)</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">invalidate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invalidate all pre-warmed resources (prediction was wrong).&quot;&quot;&quot;</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmed</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">was_prediction_useful</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actual_task_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the pre-warmed prediction matched what actually happened.&quot;&quot;&quot;</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>        <span class="n">predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicted_task_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>        <span class="k">return</span> <span class="n">predicted</span> <span class="o">==</span> <span class="n">actual_task_type</span>
</code></pre></div>
<h3 id="class-proactivepredictionengine">Class: ProactivePredictionEngine<a class="headerlink" href="#class-proactivepredictionengine" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ProactivePredictionEngine</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="sd">    Main proactive prediction engine. Wraps the existing PredictionEngine</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="sd">    and adds conversation-level prediction capabilities.</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="sd">    The existing PredictionEngine handles: predict action outcome -&gt; compare -&gt; surprise.</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="sd">    This engine handles: predict NEXT USER TURN -&gt; pre-warm -&gt; verify after turn.</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="sd">    Integration:</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="sd">    - Called asynchronously between user turns (not blocking the response)</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="sd">    - Results stored in working memory for the orchestrator to consume</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="sd">    - Feeds into AdaptationFilter: novel predictions get high attention,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="sd">      habituated predictions (same pattern repeated) get less attention</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="sd">    Usage:</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="sd">        proactive = ProactivePredictionEngine(memory=fabric)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="sd">        # After each turn completes:</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="sd">        proactive.record_turn(ConversationTurn(...))</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="sd">        next_prediction = proactive.predict_next_turn()</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="sd">        # Pre-warm in background:</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="sd">        await proactive.schedule_pre_warming(next_prediction)</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="sd">        # When next turn arrives, verify:</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="sd">        was_correct = proactive.verify_prediction(actual_task_type)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>        <span class="n">memory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MemoryFabric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>        <span class="n">weight_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WeightEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="p">):</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span> <span class="o">=</span> <span class="n">ConversationTrajectoryModel</span><span class="p">()</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chain_cache</span> <span class="o">=</span> <span class="n">PredictionChainCache</span><span class="p">()</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmer</span> <span class="o">=</span> <span class="n">PreWarmingScheduler</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">)</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_engine</span> <span class="o">=</span> <span class="n">weight_engine</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="n">memory</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>        <span class="c1"># History of proactive predictions for accuracy tracking</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">NextTurnPrediction</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>        <span class="c1"># Current pending prediction</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NextTurnPrediction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>        <span class="c1"># Task type -&gt; best model mapping (learned)</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_model_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>        <span class="c1"># Task type -&gt; common tools mapping (learned)</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_tool_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_turn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn</span><span class="p">:</span> <span class="n">ConversationTurn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a completed conversation turn for trajectory modeling.&quot;&quot;&quot;</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">record_turn</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>        <span class="c1"># Update task -&gt; model mapping</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>        <span class="k">if</span> <span class="n">turn</span><span class="o">.</span><span class="n">model_used</span><span class="p">:</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_task_model_map</span><span class="p">[</span><span class="n">turn</span><span class="o">.</span><span class="n">task_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">turn</span><span class="o">.</span><span class="n">model_used</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>        <span class="c1"># Update task -&gt; tools mapping</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>        <span class="k">if</span> <span class="n">turn</span><span class="o">.</span><span class="n">tools_used</span><span class="p">:</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_tool_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">turn</span><span class="o">.</span><span class="n">task_type</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">turn</span><span class="o">.</span><span class="n">tools_used</span><span class="p">:</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>                <span class="k">if</span> <span class="n">tool</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>                    <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_task_tool_map</span><span class="p">[</span><span class="n">turn</span><span class="o">.</span><span class="n">task_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>  <span class="c1"># Keep recent 10</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>        <span class="c1"># Record sequence for chain learning</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>        <span class="n">recent_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">task_type</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]]</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_types</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_chain_cache</span><span class="o">.</span><span class="n">record_sequence</span><span class="p">(</span><span class="n">recent_types</span><span class="p">)</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>        <span class="c1"># Verify previous prediction</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="p">:</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>            <span class="n">was_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="o">.</span><span class="n">predicted_task_type</span> <span class="o">==</span> <span class="n">turn</span><span class="o">.</span><span class="n">task_type</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="p">,</span> <span class="n">was_correct</span><span class="p">))</span>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy_window</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_accuracy_window</span><span class="p">:]</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a>            <span class="c1"># Update chain accuracy</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="o">.</span><span class="n">chain_id</span><span class="p">:</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_chain_cache</span><span class="o">.</span><span class="n">update_accuracy</span><span class="p">(</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="o">.</span><span class="n">chain_id</span><span class="p">,</span> <span class="n">was_correct</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a>                <span class="p">)</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict_next_turn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextTurnPrediction</span><span class="p">:</span>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="sd">        Generate a proactive prediction for the next user turn.</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="sd">        Algorithm:</span>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="sd">        1. Check chain cache for known sequence match (highest priority)</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="sd">        2. Use trajectory model (Markov chain) as fallback</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="sd">        3. Combine with weight engine data for tool/model selection</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="sd">        4. Compute confidence from historical accuracy</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="sd">        Mathematical model:</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="sd">          final_confidence = chain_confidence * chain_weight</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="sd">                           + trajectory_confidence * trajectory_weight</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="sd">          where:</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a><span class="sd">            chain_weight = 0.7 if chain match found, else 0.0</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a><span class="sd">            trajectory_weight = 1.0 - chain_weight</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>        <span class="n">recent_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">task_type</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]]</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>        <span class="c1"># 1. Try chain matching</span>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>        <span class="n">chain_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chain_cache</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">recent_types</span><span class="p">)</span>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>        <span class="n">chain_prediction</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>        <span class="n">chain_confidence</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>        <span class="k">if</span> <span class="n">chain_match</span><span class="p">:</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>            <span class="n">chain</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">chain_match</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>            <span class="n">chain_prediction</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">next_predicted</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>            <span class="n">chain_confidence</span> <span class="o">=</span> <span class="n">conf</span>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>        <span class="c1"># 2. Trajectory model prediction</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>        <span class="n">trajectory_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">predict_next</span><span class="p">()</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>        <span class="n">trajectory_top</span> <span class="o">=</span> <span class="n">trajectory_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">trajectory_preds</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;conversation&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>        <span class="n">trajectory_prediction</span><span class="p">,</span> <span class="n">trajectory_confidence</span> <span class="o">=</span> <span class="n">trajectory_top</span>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>        <span class="c1"># 3. Combine</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>        <span class="k">if</span> <span class="n">chain_prediction</span> <span class="ow">and</span> <span class="n">chain_confidence</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>            <span class="c1"># Chain match found and confident enough</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>            <span class="n">predicted_type</span> <span class="o">=</span> <span class="n">chain_prediction</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>            <span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">chain_confidence</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">trajectory_confidence</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>            <span class="n">basis</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chain match: </span><span class="si">{</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recent_types</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">chain_prediction</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>            <span class="n">chain_id</span> <span class="o">=</span> <span class="n">chain_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">chain_id</span> <span class="k">if</span> <span class="n">chain_match</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>            <span class="c1"># Use trajectory model</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>            <span class="n">predicted_type</span> <span class="o">=</span> <span class="n">trajectory_prediction</span>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>            <span class="n">confidence</span> <span class="o">=</span> <span class="n">trajectory_confidence</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>            <span class="n">basis</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trajectory model (top prediction from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trajectory_preds</span><span class="p">)</span><span class="si">}</span><span class="s2"> candidates)&quot;</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>            <span class="n">chain_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>        <span class="c1"># 4. Look up associated tools and model</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>        <span class="n">predicted_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_tool_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">predicted_type</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>        <span class="n">predicted_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_model_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">predicted_type</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>        <span class="c1"># 5. Estimate complexity from recent trend</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>        <span class="n">recent_complexities</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">complexity</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">_history</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]]</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>        <span class="n">predicted_complexity</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">recent_complexities</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_complexities</span><span class="p">)</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>            <span class="k">if</span> <span class="n">recent_complexities</span> <span class="k">else</span> <span class="mf">0.5</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>        <span class="p">)</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>        <span class="c1"># 6. Determine pre-warm actions</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>        <span class="n">pre_warm_actions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>        <span class="k">if</span> <span class="n">predicted_tools</span><span class="p">:</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>            <span class="n">pre_warm_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_tools:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predicted_tools</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>        <span class="k">if</span> <span class="n">predicted_model</span><span class="p">:</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>            <span class="n">pre_warm_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;select_model:</span><span class="si">{</span><span class="n">predicted_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>        <span class="n">pre_warm_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fetch_context:</span><span class="si">{</span><span class="n">predicted_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>        <span class="c1"># 7. Modulate confidence by historical accuracy</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>        <span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prediction_accuracy</span><span class="p">()</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>        <span class="n">confidence</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">accuracy</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Scale by track record</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">NextTurnPrediction</span><span class="p">(</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>            <span class="n">predicted_task_type</span><span class="o">=</span><span class="n">predicted_type</span><span class="p">,</span>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>            <span class="n">confidence</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">confidence</span><span class="p">),</span>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>            <span class="n">predicted_tools</span><span class="o">=</span><span class="n">predicted_tools</span><span class="p">,</span>
<a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>            <span class="n">predicted_model</span><span class="o">=</span><span class="n">predicted_model</span><span class="p">,</span>
<a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>            <span class="n">predicted_complexity</span><span class="o">=</span><span class="n">predicted_complexity</span><span class="p">,</span>
<a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>            <span class="n">prediction_basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
<a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>            <span class="n">pre_warm_actions</span><span class="o">=</span><span class="n">pre_warm_actions</span><span class="p">,</span>
<a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>            <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">,</span>
<a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>        <span class="p">)</span>
<a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>
<a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span> <span class="o">=</span> <span class="n">prediction</span>
<a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>        <span class="k">return</span> <span class="n">prediction</span>
<a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>
<a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">schedule_pre_warming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">NextTurnPrediction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Schedule pre-warming in the background based on prediction.&quot;&quot;&quot;</span>
<a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>        <span class="k">if</span> <span class="n">prediction</span><span class="o">.</span><span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># Only pre-warm if reasonably confident</span>
<a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmer</span><span class="o">.</span><span class="n">pre_warm</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
<a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>
<a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_pre_warmed_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get any pre-warmed resources from the last prediction.&quot;&quot;&quot;</span>
<a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_warmer</span><span class="o">.</span><span class="n">get_pre_warmed</span><span class="p">()</span>
<a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>
<a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_prediction_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a><span class="sd">        Compute the rolling accuracy of proactive predictions.</span>
<a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a><span class="sd">        Returns 0.0 to 1.0.</span>
<a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>        <span class="n">recent</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>            <span class="n">correct</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">correct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_accuracy_window</span><span class="p">:]</span>
<a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>            <span class="k">if</span> <span class="n">correct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>        <span class="p">]</span>
<a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">recent</span><span class="p">:</span>
<a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>            <span class="k">return</span> <span class="mf">0.5</span>  <span class="c1"># Prior: assume 50% accuracy</span>
<a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent</span> <span class="k">if</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent</span><span class="p">)</span>
<a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>
<a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get proactive prediction statistics.&quot;&quot;&quot;</span>
<a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>            <span class="s2">&quot;total_predictions&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_history</span><span class="p">),</span>
<a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prediction_accuracy</span><span class="p">(),</span>
<a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a>            <span class="s2">&quot;trajectory_entropy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span><span class="o">.</span><span class="n">get_trajectory_entropy</span><span class="p">(),</span>
<a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>            <span class="s2">&quot;chain_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chain_cache</span><span class="o">.</span><span class="n">_chains</span><span class="p">),</span>
<a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>            <span class="s2">&quot;known_task_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_model_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>            <span class="s2">&quot;current_prediction&quot;</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span><span class="o">.</span><span class="n">predicted_task_type</span>
<a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_prediction</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>            <span class="p">),</span>
<a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>        <span class="p">}</span>
</code></pre></div>
<h3 id="integration-points">Integration Points<a class="headerlink" href="#integration-points" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Existing File</th>
<th>Integration Point</th>
<th>Change Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>corteX/engine/prediction.py</code></td>
<td>Add new classes</td>
<td>ProactivePredictionEngine and supporting classes added to existing file</td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.__init__()</code></td>
<td>Initialize <code>self.proactive = ProactivePredictionEngine(memory=self.memory, weight_engine=self.weights)</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.run()</code></td>
<td>After step 13 (memory store), add: <code>self.proactive.record_turn(turn)</code> and <code>next_pred = self.proactive.predict_next_turn()</code> and <code>await self.proactive.schedule_pre_warming(next_pred)</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.run()</code> step 4</td>
<td>Before prediction, check <code>pre_warmed = self.proactive.get_pre_warmed_resources()</code> to use pre-selected model</td>
</tr>
<tr>
<td><code>corteX/engine/adaptation.py</code></td>
<td><code>AdaptationFilter.process()</code></td>
<td>Proactive predictions feed as signals: novel predictions amplified, repeated predictions habituated</td>
</tr>
<tr>
<td><code>corteX/engine/__init__.py</code></td>
<td>Module docstring</td>
<td>Update to include proactive prediction</td>
</tr>
</tbody>
</table>
<h3 id="test-scenarios-10">Test Scenarios (10+)<a class="headerlink" href="#test-scenarios-10" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Cold start</strong>: No history. <code>predict_next_turn()</code> returns default ("conversation") with low confidence.</li>
<li><strong>Simple sequence</strong>: User sends coding, coding, coding. Predict "coding" with increasing confidence.</li>
<li><strong>Chain detection</strong>: User pattern A-&gt;B-&gt;C seen 5 times. On A-&gt;B, predict C with high confidence.</li>
<li><strong>Chain breaking</strong>: Known chain A-&gt;B-&gt;C, but user sends D. Accuracy tracking updates, chain weakened.</li>
<li><strong>Pre-warming hit</strong>: Predicted "coding" -&gt; pre-warmed code_interpreter. Actual = coding. Verify <code>was_prediction_useful() == True</code>.</li>
<li><strong>Pre-warming miss</strong>: Predicted "coding" but actual = "research". Pre-warmed resources invalidated.</li>
<li><strong>Low confidence skip</strong>: Prediction confidence &lt; 0.3. Pre-warming should NOT be triggered.</li>
<li><strong>Trajectory entropy</strong>: Unpredictable user (random task types). Entropy should be high, confidence low.</li>
<li><strong>Recency decay</strong>: Old chain (from 48 hours ago) should have lower confidence than recent chain.</li>
<li><strong>Accuracy feedback loop</strong>: After 10 wrong predictions, overall confidence modulator should reduce all confidences.</li>
<li><strong>Multi-candidate</strong>: Trajectory model returns 3 candidates. Verify the top candidate is selected.</li>
<li><strong>Chain length priority</strong>: Both 2-gram and 3-gram chains match. 3-gram should win (more specific).</li>
<li><strong>Session boundary</strong>: New session starts. Trajectory resets but chain cache persists.</li>
</ol>
<h3 id="edge-cases-and-failure-modes">Edge Cases and Failure Modes<a class="headerlink" href="#edge-cases-and-failure-modes" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Degenerate chains</strong>: User alternates A, B, A, B -- creates contradictory chains. Solution: chain minimum occurrence threshold.</li>
<li><strong>Cold user</strong>: Brand new user with zero history. All predictions default, pre-warming disabled.</li>
<li><strong>Model not available</strong>: Pre-warmed model is unavailable at execution time. Graceful fallback to default.</li>
<li><strong>Concurrent modifications</strong>: Pre-warming runs async while user sends next message. Pre-warm must be thread-safe or use asyncio locks.</li>
<li><strong>Memory pressure</strong>: Too many chains stored. Pruning removes lowest-scored chains.</li>
</ul>
<hr />
<h2 id="p1-cross-modal-association">P1: Cross-Modal Association<a class="headerlink" href="#p1-cross-modal-association" title="Permanent link">&para;</a></h2>
<h3 id="neuroscience-basis_1">Neuroscience Basis<a class="headerlink" href="#neuroscience-basis_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>"Everything is connected to everything through synapses. Almost any neuron you take,
through a few relay stations, is connected to every other cell." - Prof. Segev, Lecture 4</p>
<p>The monkey trained to identify shapes by TOUCH cannot transfer that knowledge to VISION.
But humans can, because "in our brain there are such intensive connections between areas
that I immediately know how to associate something I touch." - Lecture 4, lines 976-1000</p>
</blockquote>
<h3 id="architecture-overview_1">Architecture Overview<a class="headerlink" href="#architecture-overview_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>CrossModalAssociator
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  |
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  +-- DomainSimilarityMap (defines which task types are &quot;nearby&quot;)
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  |
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>  +-- TransferLearningEngine (applies echo updates across domains)
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  |
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>  +-- AssociationStrengthTracker (tracks and decays cross-domain links)
</code></pre></div>
<h3 id="file-cortexengineassociationpy-new-file">File: <code>corteX/engine/association.py</code> (New File)<a class="headerlink" href="#file-cortexengineassociationpy-new-file" title="Permanent link">&para;</a></h3>
<h3 id="data-structures_1">Data Structures<a class="headerlink" href="#data-structures_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">DomainAssociation</span><span class="p">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A learned association between two task type domains.&quot;&quot;&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">domain_a</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">domain_b</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">strength</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># 0.0 (unrelated) to 1.0 (strongly associated)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">co_occurrence_count</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">transfer_success_count</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">transfer_failure_count</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="n">last_transfer</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="nd">@dataclass</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">TransferEvent</span><span class="p">:</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Record of a cross-modal transfer attempt.&quot;&quot;&quot;</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="n">source_domain</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">target_domain</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="n">source_pattern_key</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># e.g., &quot;code_interpreter+coding&quot;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="n">target_pattern_key</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># e.g., &quot;code_interpreter+debugging&quot;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="n">echo_strength</span><span class="p">:</span> <span class="nb">float</span>        <span class="c1"># How strong the transfer was</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="n">verified</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Was the transfer successful?</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</code></pre></div>
<h3 id="class-domainsimilaritymap">Class: DomainSimilarityMap<a class="headerlink" href="#class-domainsimilaritymap" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DomainSimilarityMap</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="sd">    Maintains a similarity graph between task type domains.</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="sd">    Similarity is both hardcoded (initial priors) and learned (from co-occurrence).</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="sd">    The similarity map is a weighted undirected graph:</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="sd">      sim(A, B) = prior_similarity * alpha + learned_similarity * (1 - alpha)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">    Prior similarities encode domain knowledge:</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="sd">      coding &lt;-&gt; debugging: 0.8 (very related)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="sd">      coding &lt;-&gt; testing: 0.7</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="sd">      research &lt;-&gt; summarization: 0.6</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="sd">      conversation &lt;-&gt; coding: 0.2 (weakly related)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="sd">    Learned similarities update based on:</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="sd">      1. Co-occurrence within sessions (user switches between domains)</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="sd">      2. Transfer success rate (echoed weights that prove correct)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="sd">    Mathematical model for learned similarity:</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="sd">      sim_learned(A, B) = co_occurrence(A,B) / (count(A) + count(B)) * 2</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="sd">                        * (transfer_successes / (transfer_successes + transfer_failures + k))</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="sd">      where k = 5 (pseudocount for Bayesian smoothing)</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    <span class="c1"># Initial prior similarities (symmetric)</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    <span class="n">DEFAULT_PRIORS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>        <span class="p">(</span><span class="s2">&quot;coding&quot;</span><span class="p">,</span> <span class="s2">&quot;debugging&quot;</span><span class="p">):</span> <span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>        <span class="p">(</span><span class="s2">&quot;coding&quot;</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">):</span> <span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>        <span class="p">(</span><span class="s2">&quot;coding&quot;</span><span class="p">,</span> <span class="s2">&quot;tool_use&quot;</span><span class="p">):</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>        <span class="p">(</span><span class="s2">&quot;debugging&quot;</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">):</span> <span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>        <span class="p">(</span><span class="s2">&quot;debugging&quot;</span><span class="p">,</span> <span class="s2">&quot;tool_use&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        <span class="p">(</span><span class="s2">&quot;research&quot;</span><span class="p">,</span> <span class="s2">&quot;summarization&quot;</span><span class="p">):</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>        <span class="p">(</span><span class="s2">&quot;research&quot;</span><span class="p">,</span> <span class="s2">&quot;reasoning&quot;</span><span class="p">):</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>        <span class="p">(</span><span class="s2">&quot;planning&quot;</span><span class="p">,</span> <span class="s2">&quot;reasoning&quot;</span><span class="p">):</span> <span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>        <span class="p">(</span><span class="s2">&quot;planning&quot;</span><span class="p">,</span> <span class="s2">&quot;coding&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>        <span class="p">(</span><span class="s2">&quot;conversation&quot;</span><span class="p">,</span> <span class="s2">&quot;summarization&quot;</span><span class="p">):</span> <span class="mf">0.4</span><span class="p">,</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>        <span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">):</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>        <span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;debugging&quot;</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="p">}</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">):</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;alpha controls the blend: 0.0 = all learned, 1.0 = all prior.&quot;&quot;&quot;</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainAssociation</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_domain_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_pair_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Canonical key for an unordered pair.&quot;&quot;&quot;</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="sd">        Get the current similarity between two domains.</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="sd">        Combines prior and learned similarity.</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>        <span class="k">if</span> <span class="n">domain_a</span> <span class="o">==</span> <span class="n">domain_b</span><span class="p">:</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>            <span class="k">return</span> <span class="mf">1.0</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>        <span class="c1"># Prior similarity</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>        <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">))</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>        <span class="n">prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PRIORS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Default: slight association</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>        <span class="c1"># Learned similarity</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pair_key</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">)</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>        <span class="n">assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>        <span class="k">if</span> <span class="n">assoc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a>            <span class="k">return</span> <span class="n">prior</span>  <span class="c1"># No learned data yet</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a>        <span class="c1"># Co-occurrence based similarity</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>        <span class="n">total_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain_b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>        <span class="n">co_occ_sim</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">assoc</span><span class="o">.</span><span class="n">co_occurrence_count</span> <span class="o">/</span> <span class="n">total_count</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>        <span class="c1"># Transfer success rate</span>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a>        <span class="n">total_transfers</span> <span class="o">=</span> <span class="n">assoc</span><span class="o">.</span><span class="n">transfer_success_count</span> <span class="o">+</span> <span class="n">assoc</span><span class="o">.</span><span class="n">transfer_failure_count</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>        <span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Pseudocount</span>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a>        <span class="n">transfer_sim</span> <span class="o">=</span> <span class="n">assoc</span><span class="o">.</span><span class="n">transfer_success_count</span> <span class="o">/</span> <span class="p">(</span><span class="n">total_transfers</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>        <span class="n">learned</span> <span class="o">=</span> <span class="n">co_occ_sim</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">transfer_sim</span> <span class="o">*</span> <span class="mf">0.5</span>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a>        <span class="c1"># Blend prior and learned</span>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">prior</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">learned</span>
<a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a>
<a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_co_occurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record that two domains appeared in the same session context.&quot;&quot;&quot;</span>
<a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a>        <span class="k">if</span> <span class="n">domain_a</span> <span class="o">==</span> <span class="n">domain_b</span><span class="p">:</span>
<a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a>            <span class="k">return</span>
<a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_domain_counts</span><span class="p">[</span><span class="n">domain_a</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_domain_counts</span><span class="p">[</span><span class="n">domain_b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a>
<a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a>        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pair_key</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">)</span>
<a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="p">:</span>
<a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">DomainAssociation</span><span class="p">(</span>
<a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a>                <span class="n">domain_a</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">),</span>
<a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a>                <span class="n">domain_b</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">),</span>
<a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a>                <span class="n">strength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a>                <span class="n">co_occurrence_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a>                <span class="n">transfer_success_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a>                <span class="n">transfer_failure_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a>            <span class="p">)</span>
<a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">co_occurrence_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a>
<a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_transfer_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record whether a cross-modal transfer was successful.&quot;&quot;&quot;</span>
<a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a>        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pair_key</span><span class="p">(</span><span class="n">domain_a</span><span class="p">,</span> <span class="n">domain_b</span><span class="p">)</span>
<a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a>        <span class="n">assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a>        <span class="k">if</span> <span class="n">assoc</span><span class="p">:</span>
<a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a>            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
<a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a>                <span class="n">assoc</span><span class="o">.</span><span class="n">transfer_success_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-8-109" name="__codelineno-8-109" href="#__codelineno-8-109"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-110" name="__codelineno-8-110" href="#__codelineno-8-110"></a>                <span class="n">assoc</span><span class="o">.</span><span class="n">transfer_failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-8-111" name="__codelineno-8-111" href="#__codelineno-8-111"></a>
<a id="__codelineno-8-112" name="__codelineno-8-112" href="#__codelineno-8-112"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_related_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-8-113" name="__codelineno-8-113" href="#__codelineno-8-113"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all domains related to the given domain above threshold.&quot;&quot;&quot;</span>
<a id="__codelineno-8-114" name="__codelineno-8-114" href="#__codelineno-8-114"></a>        <span class="n">all_domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-8-115" name="__codelineno-8-115" href="#__codelineno-8-115"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associations</span><span class="p">:</span>
<a id="__codelineno-8-116" name="__codelineno-8-116" href="#__codelineno-8-116"></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-8-117" name="__codelineno-8-117" href="#__codelineno-8-117"></a>            <span class="n">all_domains</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
<a id="__codelineno-8-118" name="__codelineno-8-118" href="#__codelineno-8-118"></a>        <span class="c1"># Also include domains from priors</span>
<a id="__codelineno-8-119" name="__codelineno-8-119" href="#__codelineno-8-119"></a>        <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PRIORS</span><span class="p">:</span>
<a id="__codelineno-8-120" name="__codelineno-8-120" href="#__codelineno-8-120"></a>            <span class="n">all_domains</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-8-121" name="__codelineno-8-121" href="#__codelineno-8-121"></a>            <span class="n">all_domains</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-8-122" name="__codelineno-8-122" href="#__codelineno-8-122"></a>
<a id="__codelineno-8-123" name="__codelineno-8-123" href="#__codelineno-8-123"></a>        <span class="n">related</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-124" name="__codelineno-8-124" href="#__codelineno-8-124"></a>        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">all_domains</span><span class="p">:</span>
<a id="__codelineno-8-125" name="__codelineno-8-125" href="#__codelineno-8-125"></a>            <span class="k">if</span> <span class="n">other</span> <span class="o">!=</span> <span class="n">domain</span><span class="p">:</span>
<a id="__codelineno-8-126" name="__codelineno-8-126" href="#__codelineno-8-126"></a>                <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_similarity</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<a id="__codelineno-8-127" name="__codelineno-8-127" href="#__codelineno-8-127"></a>                <span class="k">if</span> <span class="n">sim</span> <span class="o">&gt;=</span> <span class="n">min_similarity</span><span class="p">:</span>
<a id="__codelineno-8-128" name="__codelineno-8-128" href="#__codelineno-8-128"></a>                    <span class="n">related</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">other</span><span class="p">,</span> <span class="n">sim</span><span class="p">))</span>
<a id="__codelineno-8-129" name="__codelineno-8-129" href="#__codelineno-8-129"></a>        <span class="n">related</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-130" name="__codelineno-8-130" href="#__codelineno-8-130"></a>        <span class="k">return</span> <span class="n">related</span>
</code></pre></div>
<h3 id="class-crossmodalassociator">Class: CrossModalAssociator<a class="headerlink" href="#class-crossmodalassociator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CrossModalAssociator</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="sd">    The main cross-modal association engine.</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="sd">    After a successful Hebbian update in one domain, applies a weaker</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="sd">    &quot;echo&quot; update to associated domains.</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd">    Brain analogy: When you learn that a rough texture (touch) is</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">    associated with a visual pattern, future encounters with that</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">    visual pattern already activate touch-related predictions.</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="sd">    Echo update formula:</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="sd">      echo_delta = original_delta * similarity(source, target) * echo_decay</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="sd">      where echo_decay = 0.3 (echoes are 30% of original strength at max similarity)</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="sd">    This means:</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="sd">    - If coding success strengthens code_interpreter by +0.1,</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="sd">      and similarity(coding, debugging) = 0.8:</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="sd">      debugging echo = 0.1 * 0.8 * 0.3 = 0.024</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="sd">    Integration with PlasticityManager:</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="sd">    - Called by PlasticityManager.on_step_complete() after Hebbian rule fires</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="sd">    - Generates additional PlasticityEvents for the echo updates</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="sd">    Usage:</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="sd">        associator = CrossModalAssociator(weight_engine, similarity_map)</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="sd">        # After a successful Hebbian update</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="sd">        echo_events = associator.propagate_learning(</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="sd">            source_domain=&quot;coding&quot;,</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="sd">            pattern_key=&quot;code_interpreter+coding&quot;,</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="sd">            delta=0.1,</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="sd">            outcome_quality=0.85,</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="sd">        )</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>        <span class="n">weight_engine</span><span class="p">:</span> <span class="n">WeightEngine</span><span class="p">,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>        <span class="n">similarity_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DomainSimilarityMap</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>        <span class="n">echo_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>        <span class="n">min_echo_strength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="n">max_echo_domains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="p">):</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weight_engine</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span> <span class="o">=</span> <span class="n">similarity_map</span> <span class="ow">or</span> <span class="n">DomainSimilarityMap</span><span class="p">()</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_echo_decay</span> <span class="o">=</span> <span class="n">echo_decay</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_min_echo</span> <span class="o">=</span> <span class="n">min_echo_strength</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_domains</span> <span class="o">=</span> <span class="n">max_echo_domains</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transfer_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TransferEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_learning</span><span class="p">(</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>        <span class="n">source_domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>        <span class="n">pattern_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>        <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>        <span class="n">outcome_quality</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PlasticityEvent</span><span class="p">]:</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="sd">        Propagate learning from source domain to associated domains.</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a><span class="sd">        Args:</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a><span class="sd">            source_domain: The task type where the original learning occurred</span>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a><span class="sd">            pattern_key: The weight pattern key (e.g., &quot;code_interpreter+coding&quot;)</span>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="sd">            delta: The original Hebbian delta applied</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a><span class="sd">            outcome_quality: The quality of the original outcome (0.0 to 1.0)</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a><span class="sd">        Returns:</span>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a><span class="sd">            List of PlasticityEvents for the echo updates</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>        <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PlasticityEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>        <span class="c1"># Only propagate sufficiently strong learning signals</span>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_echo</span><span class="p">:</span>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>            <span class="k">return</span> <span class="n">events</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>        <span class="c1"># Only propagate on quality outcomes (don&#39;t spread failure aggressively)</span>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>        <span class="k">if</span> <span class="n">outcome_quality</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>            <span class="k">return</span> <span class="n">events</span>
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>        <span class="c1"># Get related domains</span>
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>        <span class="n">related</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span><span class="o">.</span><span class="n">get_related_domains</span><span class="p">(</span><span class="n">source_domain</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_domains</span><span class="p">]</span>
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>        <span class="c1"># Parse the pattern key to extract tool/model</span>
<a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">pattern_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
<a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>            <span class="k">return</span> <span class="n">events</span>
<a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>        <span class="n">tool_or_model</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parts</span>
<a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>
<a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>        <span class="k">for</span> <span class="n">target_domain</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="n">related</span><span class="p">:</span>
<a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>            <span class="c1"># Compute echo strength</span>
<a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>            <span class="n">echo_delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">similarity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echo_decay</span>
<a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>
<a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>            <span class="c1"># Below threshold? Skip.</span>
<a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">echo_delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_echo</span><span class="p">:</span>
<a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>                <span class="k">continue</span>
<a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>
<a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>            <span class="c1"># Apply echo update to weight engine</span>
<a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>            <span class="n">target_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tool_or_model</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">target_domain</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target_domain</span><span class="p">,</span> <span class="n">tool_or_model</span><span class="p">,</span> <span class="n">echo_delta</span><span class="p">)</span>
<a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>
<a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>            <span class="c1"># Record the transfer</span>
<a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>            <span class="n">transfer</span> <span class="o">=</span> <span class="n">TransferEvent</span><span class="p">(</span>
<a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>                <span class="n">source_domain</span><span class="o">=</span><span class="n">source_domain</span><span class="p">,</span>
<a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>                <span class="n">target_domain</span><span class="o">=</span><span class="n">target_domain</span><span class="p">,</span>
<a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>                <span class="n">source_pattern_key</span><span class="o">=</span><span class="n">pattern_key</span><span class="p">,</span>
<a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>                <span class="n">target_pattern_key</span><span class="o">=</span><span class="n">target_key</span><span class="p">,</span>
<a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>                <span class="n">echo_strength</span><span class="o">=</span><span class="n">echo_delta</span><span class="p">,</span>
<a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>            <span class="p">)</span>
<a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_transfer_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transfer</span><span class="p">)</span>
<a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>
<a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>            <span class="c1"># Record co-occurrence</span>
<a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span><span class="o">.</span><span class="n">record_co_occurrence</span><span class="p">(</span><span class="n">source_domain</span><span class="p">,</span> <span class="n">target_domain</span><span class="p">)</span>
<a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>
<a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>            <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PlasticityEvent</span><span class="p">(</span>
<a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;cross_modal_echo&quot;</span><span class="p">,</span>
<a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>                <span class="n">affected_weights</span><span class="o">=</span><span class="p">[</span><span class="n">target_key</span><span class="p">],</span>
<a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>                <span class="n">magnitude</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">echo_delta</span><span class="p">),</span>
<a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>                <span class="n">details</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>                    <span class="sa">f</span><span class="s2">&quot;Echo from </span><span class="si">{</span><span class="n">source_domain</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">target_domain</span><span class="si">}</span><span class="s2">: &quot;</span>
<a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>                    <span class="sa">f</span><span class="s2">&quot;delta=</span><span class="si">{</span><span class="n">echo_delta</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> (sim=</span><span class="si">{</span><span class="n">similarity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>                <span class="p">),</span>
<a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>            <span class="p">))</span>
<a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>
<a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>        <span class="k">return</span> <span class="n">events</span>
<a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>
<a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_transfers</span><span class="p">(</span>
<a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a>        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>        <span class="n">tool_or_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a>        <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a><span class="sd">        After a step in a target domain, verify whether previous</span>
<a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a><span class="sd">        echo transfers to this domain were helpful.</span>
<a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>
<a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a><span class="sd">        Updates the similarity map based on transfer outcomes.</span>
<a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>        <span class="c1"># Find recent unverified transfers targeting this domain</span>
<a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>        <span class="k">for</span> <span class="n">transfer</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transfer_history</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:]):</span>
<a id="__codelineno-9-140" name="__codelineno-9-140" href="#__codelineno-9-140"></a>            <span class="k">if</span> <span class="n">transfer</span><span class="o">.</span><span class="n">target_domain</span> <span class="o">==</span> <span class="n">domain</span> <span class="ow">and</span> <span class="n">transfer</span><span class="o">.</span><span class="n">verified</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-9-141" name="__codelineno-9-141" href="#__codelineno-9-141"></a>                <span class="n">transfer</span><span class="o">.</span><span class="n">verified</span> <span class="o">=</span> <span class="n">success</span>
<a id="__codelineno-9-142" name="__codelineno-9-142" href="#__codelineno-9-142"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span><span class="o">.</span><span class="n">record_transfer_result</span><span class="p">(</span>
<a id="__codelineno-9-143" name="__codelineno-9-143" href="#__codelineno-9-143"></a>                    <span class="n">transfer</span><span class="o">.</span><span class="n">source_domain</span><span class="p">,</span>
<a id="__codelineno-9-144" name="__codelineno-9-144" href="#__codelineno-9-144"></a>                    <span class="n">transfer</span><span class="o">.</span><span class="n">target_domain</span><span class="p">,</span>
<a id="__codelineno-9-145" name="__codelineno-9-145" href="#__codelineno-9-145"></a>                    <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-9-146" name="__codelineno-9-146" href="#__codelineno-9-146"></a>                <span class="p">)</span>
<a id="__codelineno-9-147" name="__codelineno-9-147" href="#__codelineno-9-147"></a>
<a id="__codelineno-9-148" name="__codelineno-9-148" href="#__codelineno-9-148"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-9-149" name="__codelineno-9-149" href="#__codelineno-9-149"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get cross-modal association statistics.&quot;&quot;&quot;</span>
<a id="__codelineno-9-150" name="__codelineno-9-150" href="#__codelineno-9-150"></a>        <span class="n">verified</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer_history</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">verified</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-9-151" name="__codelineno-9-151" href="#__codelineno-9-151"></a>        <span class="n">successes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">verified</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">verified</span><span class="p">)</span>
<a id="__codelineno-9-152" name="__codelineno-9-152" href="#__codelineno-9-152"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-9-153" name="__codelineno-9-153" href="#__codelineno-9-153"></a>            <span class="s2">&quot;total_transfers&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transfer_history</span><span class="p">),</span>
<a id="__codelineno-9-154" name="__codelineno-9-154" href="#__codelineno-9-154"></a>            <span class="s2">&quot;verified_transfers&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">verified</span><span class="p">),</span>
<a id="__codelineno-9-155" name="__codelineno-9-155" href="#__codelineno-9-155"></a>            <span class="s2">&quot;transfer_success_rate&quot;</span><span class="p">:</span> <span class="n">successes</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verified</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-9-156" name="__codelineno-9-156" href="#__codelineno-9-156"></a>            <span class="s2">&quot;active_domains&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span><span class="o">.</span><span class="n">_domain_counts</span><span class="p">),</span>
<a id="__codelineno-9-157" name="__codelineno-9-157" href="#__codelineno-9-157"></a>            <span class="s2">&quot;association_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_similarity</span><span class="o">.</span><span class="n">_associations</span><span class="p">),</span>
<a id="__codelineno-9-158" name="__codelineno-9-158" href="#__codelineno-9-158"></a>        <span class="p">}</span>
</code></pre></div>
<h3 id="integration-points_1">Integration Points<a class="headerlink" href="#integration-points_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Existing File</th>
<th>Integration Point</th>
<th>Change Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>corteX/engine/association.py</code></td>
<td>New file</td>
<td>Contains DomainSimilarityMap and CrossModalAssociator</td>
</tr>
<tr>
<td><code>corteX/engine/plasticity.py</code></td>
<td><code>PlasticityManager.__init__()</code></td>
<td>Add <code>self.associator = CrossModalAssociator(weight_engine)</code></td>
</tr>
<tr>
<td><code>corteX/engine/plasticity.py</code></td>
<td><code>PlasticityManager.on_step_complete()</code></td>
<td>After Hebbian rule fires, call <code>self.associator.propagate_learning(task_type, pattern_key, hebbian_delta, quality)</code></td>
</tr>
<tr>
<td><code>corteX/engine/plasticity.py</code></td>
<td><code>PlasticityManager.on_step_complete()</code></td>
<td>Add <code>self.associator.verify_transfers(task_type, tool, success)</code></td>
</tr>
<tr>
<td><code>corteX/engine/__init__.py</code></td>
<td>Module docstring</td>
<td>Update to include association</td>
</tr>
</tbody>
</table>
<h3 id="test-scenarios-10_1">Test Scenarios (10+)<a class="headerlink" href="#test-scenarios-10_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Basic echo</strong>: Coding success delta +0.1, similarity(coding,debugging) = 0.8. Verify debugging receives echo of ~0.024.</li>
<li><strong>No echo below threshold</strong>: Very small delta (0.001). No echo should propagate.</li>
<li><strong>Failure suppression</strong>: Negative outcome (quality &lt; 0.4). No echo should propagate.</li>
<li><strong>Multiple targets</strong>: Source domain "coding" has 3 related domains. All 3 receive echoes.</li>
<li><strong>Asymmetric similarity</strong>: After transfer success in coding-&gt;debugging but failure in coding-&gt;conversation, similarity should diverge.</li>
<li><strong>Transfer verification</strong>: Propagate echo, then verify the target domain had success. Similarity should increase.</li>
<li><strong>Transfer failure</strong>: Propagate echo, target domain fails. Similarity should decrease.</li>
<li><strong>Co-occurrence learning</strong>: User alternates coding and debugging. Learned similarity should increase.</li>
<li><strong>Unknown domain</strong>: Source domain "exotic_task" with no priors. Default similarity (0.1) applies.</li>
<li><strong>Max domains cap</strong>: Source has 10 related domains but max_echo_domains=3. Only top 3 receive echoes.</li>
<li><strong>Bidirectional</strong>: Echo from A-&gt;B, then later from B-&gt;A. Both should work independently.</li>
<li><strong>Decay interaction</strong>: Echo propagation interacts with homeostatic regulation. Verify echoed weights don't exceed bounds.</li>
<li><strong>Population coding interaction</strong>: Echo updates should be visible as weak votes in PopulationDecoder.</li>
</ol>
<h3 id="edge-cases-and-failure-modes_1">Edge Cases and Failure Modes<a class="headerlink" href="#edge-cases-and-failure-modes_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Echo amplification loop</strong>: A echoes to B, B echoes to A, creating runaway strengthening. Solution: echo_decay ensures each hop reduces by 70%. Single-hop only (no cascading echoes).</li>
<li><strong>Stale associations</strong>: Old co-occurrences from different user behavior. Solution: time-decay associations.</li>
<li><strong>Domain explosion</strong>: Too many domains. Solution: cap on tracked associations.</li>
<li><strong>Contradictory transfers</strong>: Tool X succeeds in coding but fails in debugging. Similarity should naturally decrease via <code>record_transfer_result</code>.</li>
</ul>
<hr />
<h2 id="p1-continuous-calibration">P1: Continuous Calibration<a class="headerlink" href="#p1-continuous-calibration" title="Permanent link">&para;</a></h2>
<h3 id="neuroscience-basis_2">Neuroscience Basis<a class="headerlink" href="#neuroscience-basis_2" title="Permanent link">&para;</a></h3>
<blockquote>
<p>"You wake up in the morning - your brain needs to re-learn itself. You're not exactly the
same person as before... So the network must necessarily reorganize slightly...
This is REAL-TIME learning - the network reorganizes all the time." - Prof. Segev, Lecture 3</p>
</blockquote>
<p>The BCI (Brain-Computer Interface) adaptive algorithm continuously recalibrates the mapping
between neural signals and desired outputs. The brain's neural code is not fixed -- it drifts
daily, requiring the interface to constantly re-learn.</p>
<p>Similarly, the corteX agent-user relationship drifts: the user's preferences change, their
skill level evolves, their mood shifts between sessions. The agent must detect and adapt to
this drift continuously, not only at discrete feedback moments.</p>
<h3 id="architecture-overview_2">Architecture Overview<a class="headerlink" href="#architecture-overview_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ContinuousCalibrationEngine
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  |
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>  +-- SessionStartCalibrator (micro-calibration at session start)
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  |
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  +-- DriftDetector (detects relationship drift during session)
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  |
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>  +-- RecalibrationScheduler (periodic recalibration triggers)
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>  |
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>  +-- CalibrationMetrics (tracks calibration quality over time)
</code></pre></div>
<h3 id="file-cortexenginecalibrationpy-new-file">File: <code>corteX/engine/calibration.py</code> (New File)<a class="headerlink" href="#file-cortexenginecalibrationpy-new-file" title="Permanent link">&para;</a></h3>
<h3 id="data-structures_2">Data Structures<a class="headerlink" href="#data-structures_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">CalibrationSnapshot</span><span class="p">:</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A snapshot of the agent-user relationship state.&quot;&quot;&quot;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">snapshot_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">behavioral_weights</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">prediction_accuracy</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">feedback_distribution</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>   <span class="c1"># signal_type -&gt; count</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">avg_response_quality</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">avg_response_latency_ms</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">user_engagement_score</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="n">turn_count</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="nd">@dataclass</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">DriftReport</span><span class="p">:</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Report on detected drift between two snapshots.&quot;&quot;&quot;</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="n">dimension</span><span class="p">:</span> <span class="nb">str</span>              <span class="c1"># Which weight/metric drifted</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="n">old_value</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>    <span class="n">new_value</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>    <span class="n">drift_magnitude</span><span class="p">:</span> <span class="nb">float</span>      <span class="c1"># Absolute change</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>    <span class="n">drift_rate</span><span class="p">:</span> <span class="nb">float</span>           <span class="c1"># Change per unit time</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>    <span class="n">significance</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># 0.0 to 1.0 (statistical significance)</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>    <span class="n">recommended_action</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># &quot;no_action&quot;, &quot;recalibrate&quot;, &quot;alert&quot;</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="nd">@dataclass</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="k">class</span><span class="w"> </span><span class="nc">CalibrationResult</span><span class="p">:</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a calibration cycle.&quot;&quot;&quot;</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>    <span class="n">adjustments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>  <span class="c1"># (weight_key, old_value, new_value)</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>    <span class="n">drift_reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>    <span class="n">calibration_quality</span><span class="p">:</span> <span class="nb">float</span>                     <span class="c1"># 0.0 to 1.0</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</code></pre></div>
<h3 id="class-sessionstartcalibrator">Class: SessionStartCalibrator<a class="headerlink" href="#class-sessionstartcalibrator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SessionStartCalibrator</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="sd">    Runs micro-calibration at session start.</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">    &quot;What has changed since last session?&quot;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">    Compares the current state to the last session&#39;s end state</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">    and adjusts weights based on detected drift.</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">    The calibration process:</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="sd">    1. Load the last session&#39;s ending snapshot</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="sd">    2. Compare key metrics to detect drift</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="sd">    3. Apply &quot;wake-up&quot; adjustments:</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="sd">       - If prediction accuracy was declining: increase learning rate</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="sd">       - If user frustration was rising: pre-adjust behavioral weights</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="sd">       - If engagement was dropping: increase initiative</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="sd">    4. Apply a mild &quot;regression to mean&quot; on extreme weights</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="sd">       (analogous to the brain&#39;s overnight reorganization)</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="sd">    Mathematical model:</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="sd">      For each behavioral weight w:</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="sd">        drift_d = w_last_session_end - w_session_before_that_end</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="sd">        if |drift_d| &gt; threshold:</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="sd">          w_session_start = w_last_session_end + momentum * drift_d</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="sd">        else:</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="sd">          w_session_start = w_last_session_end * (1 - regression_rate) + w_prior * regression_rate</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="sd">    Where:</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="sd">      momentum = 0.3 (continue observed trends mildly)</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="sd">      regression_rate = 0.05 (gentle pull toward defaults)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="sd">      threshold = 0.1 (minimum drift to count as trend)</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>        <span class="n">regression_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>        <span class="n">momentum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>        <span class="n">drift_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="p">):</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regression_rate</span> <span class="o">=</span> <span class="n">regression_rate</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_momentum</span> <span class="o">=</span> <span class="n">momentum</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_drift_threshold</span> <span class="o">=</span> <span class="n">drift_threshold</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session_snapshots</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CalibrationSnapshot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>        <span class="n">weight_engine</span><span class="p">:</span> <span class="n">WeightEngine</span><span class="p">,</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>        <span class="n">previous_snapshot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CalibrationSnapshot</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>        <span class="n">older_snapshot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CalibrationSnapshot</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationResult</span><span class="p">:</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="sd">        Run session-start micro-calibration.</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a><span class="sd">        Adjusts weights based on inter-session drift analysis.</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>        <span class="n">adjustments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>        <span class="n">drift_reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>        <span class="k">if</span> <span class="n">previous_snapshot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a>            <span class="k">return</span> <span class="n">CalibrationResult</span><span class="p">(</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>                <span class="n">adjustments</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>                <span class="n">drift_reports</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a>                <span class="n">calibration_quality</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>            <span class="p">)</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>        <span class="c1"># Analyze behavioral weight drift</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">current_val</span> <span class="ow">in</span> <span class="n">weight_engine</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>            <span class="n">prev_val</span> <span class="o">=</span> <span class="n">previous_snapshot</span><span class="o">.</span><span class="n">behavioral_weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">current_val</span><span class="p">)</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>            <span class="c1"># Compute drift from two sessions ago (if available)</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>            <span class="n">trend</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>            <span class="k">if</span> <span class="n">older_snapshot</span><span class="p">:</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>                <span class="n">older_val</span> <span class="o">=</span> <span class="n">older_snapshot</span><span class="o">.</span><span class="n">behavioral_weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">prev_val</span><span class="p">)</span>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>                <span class="n">trend</span> <span class="o">=</span> <span class="n">prev_val</span> <span class="o">-</span> <span class="n">older_val</span>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a>            <span class="c1"># Apply momentum if significant trend detected</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">trend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drift_threshold</span><span class="p">:</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a>                <span class="c1"># Continue the trend mildly</span>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a>                <span class="n">adjustment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_momentum</span> <span class="o">*</span> <span class="n">trend</span>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a>                <span class="n">new_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">current_val</span> <span class="o">+</span> <span class="n">adjustment</span><span class="p">))</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">new_val</span> <span class="o">-</span> <span class="n">current_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">:</span>
<a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>                    <span class="n">weight_engine</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>
<a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>                    <span class="n">adjustments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">current_val</span><span class="p">,</span> <span class="n">new_val</span><span class="p">))</span>
<a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>                    <span class="n">drift_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DriftReport</span><span class="p">(</span>
<a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a>                        <span class="n">dimension</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;behavioral.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>                        <span class="n">old_value</span><span class="o">=</span><span class="n">current_val</span><span class="p">,</span>
<a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>                        <span class="n">new_value</span><span class="o">=</span><span class="n">new_val</span><span class="p">,</span>
<a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>                        <span class="n">drift_magnitude</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">trend</span><span class="p">),</span>
<a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>                        <span class="n">drift_rate</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">trend</span><span class="p">),</span>
<a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>                        <span class="n">significance</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">trend</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">),</span>
<a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>                        <span class="n">recommended_action</span><span class="o">=</span><span class="s2">&quot;recalibrate&quot;</span><span class="p">,</span>
<a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>                    <span class="p">))</span>
<a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>                <span class="c1"># Gentle regression toward default (0.0 for most weights)</span>
<a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a>                <span class="n">default</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>                <span class="n">regression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regression_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">default</span> <span class="o">-</span> <span class="n">current_val</span><span class="p">)</span>
<a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">regression</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">:</span>
<a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>                    <span class="n">new_val</span> <span class="o">=</span> <span class="n">current_val</span> <span class="o">+</span> <span class="n">regression</span>
<a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>                    <span class="n">weight_engine</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>
<a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>                    <span class="n">adjustments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">current_val</span><span class="p">,</span> <span class="n">new_val</span><span class="p">))</span>
<a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a>
<a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>        <span class="c1"># Analyze prediction accuracy drift</span>
<a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>        <span class="k">if</span> <span class="n">previous_snapshot</span><span class="o">.</span><span class="n">prediction_accuracy</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
<a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>            <span class="c1"># Prediction accuracy was poor last session - increase learning</span>
<a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>            <span class="n">drift_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DriftReport</span><span class="p">(</span>
<a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>                <span class="n">dimension</span><span class="o">=</span><span class="s2">&quot;prediction_accuracy&quot;</span><span class="p">,</span>
<a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>                <span class="n">old_value</span><span class="o">=</span><span class="n">previous_snapshot</span><span class="o">.</span><span class="n">prediction_accuracy</span><span class="p">,</span>
<a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>                <span class="n">new_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Target: improve</span>
<a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a>                <span class="n">drift_magnitude</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">previous_snapshot</span><span class="o">.</span><span class="n">prediction_accuracy</span><span class="p">,</span>
<a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>                <span class="n">drift_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>                <span class="n">significance</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a>                <span class="n">recommended_action</span><span class="o">=</span><span class="s2">&quot;recalibrate&quot;</span><span class="p">,</span>
<a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a>            <span class="p">))</span>
<a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a>
<a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a>        <span class="c1"># Compute calibration quality</span>
<a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a>        <span class="n">quality</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">drift_reports</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># More drift = lower quality</span>
<a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a>        <span class="n">quality</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">quality</span><span class="p">))</span>
<a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>
<a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>        <span class="k">return</span> <span class="n">CalibrationResult</span><span class="p">(</span>
<a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>            <span class="n">adjustments</span><span class="o">=</span><span class="n">adjustments</span><span class="p">,</span>
<a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>            <span class="n">drift_reports</span><span class="o">=</span><span class="n">drift_reports</span><span class="p">,</span>
<a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>            <span class="n">calibration_quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
<a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>        <span class="p">)</span>
<a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>
<a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">take_snapshot</span><span class="p">(</span>
<a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>        <span class="n">weight_engine</span><span class="p">:</span> <span class="n">WeightEngine</span><span class="p">,</span>
<a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>        <span class="n">prediction_engine</span><span class="p">:</span> <span class="n">PredictionEngine</span><span class="p">,</span>
<a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>        <span class="n">feedback_engine</span><span class="p">:</span> <span class="n">FeedbackEngine</span><span class="p">,</span>
<a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>        <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>        <span class="n">turn_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationSnapshot</span><span class="p">:</span>
<a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a snapshot of current state for future calibration.&quot;&quot;&quot;</span>
<a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>        <span class="n">snapshot</span> <span class="o">=</span> <span class="n">CalibrationSnapshot</span><span class="p">(</span>
<a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a>            <span class="n">snapshot_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;snap_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a>            <span class="n">behavioral_weights</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">weight_engine</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">weights</span><span class="p">),</span>
<a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a>            <span class="n">prediction_accuracy</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">prediction_engine</span><span class="o">.</span><span class="n">get_calibration_score</span><span class="p">(),</span>
<a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a>            <span class="n">feedback_distribution</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a>            <span class="n">avg_response_quality</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a>            <span class="n">avg_response_latency_ms</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a>            <span class="n">user_engagement_score</span><span class="o">=</span><span class="n">weight_engine</span><span class="o">.</span><span class="n">user_insights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;engagement_level&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
<a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a>            <span class="n">turn_count</span><span class="o">=</span><span class="n">turn_count</span><span class="p">,</span>
<a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a>            <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a>        <span class="p">)</span>
<a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session_snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>
<a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session_snapshots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_session_snapshots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_snapshots</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
<a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>        <span class="k">return</span> <span class="n">snapshot</span>
</code></pre></div>
<h3 id="class-driftdetector">Class: DriftDetector<a class="headerlink" href="#class-driftdetector" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DriftDetector</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="sd">    Continuously monitors for drift in the agent-user relationship.</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="sd">    Runs during a session (not just at boundaries).</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="sd">    Drift types detected:</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="sd">    1. Behavioral drift: User&#39;s preferences change within a session</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="sd">    2. Performance drift: Agent&#39;s accuracy degrades</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="sd">    3. Engagement drift: User engagement level changes</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="sd">    4. Complexity drift: Task complexity shifts up or down</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="sd">    Detection method: Exponentially weighted moving average (EWMA)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="sd">    control chart. When a metric&#39;s EWMA crosses +/- 2 sigma from</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="sd">    the running mean, drift is detected.</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="sd">    Mathematical model:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="sd">      EWMA_t = lambda * x_t + (1 - lambda) * EWMA_{t-1}</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="sd">      where lambda = 2 / (span + 1), span = 10</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="sd">      Upper control limit = mean + L * sigma * sqrt(lambda / (2 - lambda))</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="sd">      Lower control limit = mean - L * sigma * sqrt(lambda / (2 - lambda))</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="sd">      where L = 2.5 (sensitivity parameter)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ewma_span</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">):</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lambda</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ewma_span</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">=</span> <span class="n">sensitivity</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running_mean</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running_var</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]:</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="sd">        Record a metric value and check for drift.</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="sd">        Returns a DriftReport if drift is detected, else None.</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">][</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>        <span class="c1"># Update EWMA</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>        <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">:</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_running_mean</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_running_var</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>        <span class="n">prev_ewma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lambda</span> <span class="o">*</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lambda</span><span class="p">)</span> <span class="o">*</span> <span class="n">prev_ewma</span>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>        <span class="c1"># Update running statistics</span>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">])</span>
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>        <span class="n">old_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_mean</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>        <span class="n">new_mean</span> <span class="o">=</span> <span class="n">old_mean</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">old_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running_mean</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mean</span>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>            <span class="n">old_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_var</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>            <span class="n">new_var</span> <span class="o">=</span> <span class="n">old_var</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">old_mean</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">new_mean</span><span class="p">)</span>
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_running_var</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_var</span>
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>            <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">new_var</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.0</span>
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>            <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Not enough data yet</span>
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>        <span class="c1"># Control limits</span>
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>        <span class="n">control_factor</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lambda</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lambda</span><span class="p">))</span>
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>        <span class="n">ucl</span> <span class="o">=</span> <span class="n">new_mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">*</span> <span class="n">control_factor</span>
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>        <span class="n">lcl</span> <span class="o">=</span> <span class="n">new_mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">*</span> <span class="n">control_factor</span>
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>        <span class="c1"># Check for drift</span>
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>        <span class="n">current_ewma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>        <span class="k">if</span> <span class="n">current_ewma</span> <span class="o">&gt;</span> <span class="n">ucl</span> <span class="ow">or</span> <span class="n">current_ewma</span> <span class="o">&lt;</span> <span class="n">lcl</span><span class="p">:</span>
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>            <span class="n">drift_mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_ewma</span> <span class="o">-</span> <span class="n">new_mean</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>            <span class="k">return</span> <span class="n">DriftReport</span><span class="p">(</span>
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>                <span class="n">dimension</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>                <span class="n">old_value</span><span class="o">=</span><span class="n">new_mean</span><span class="p">,</span>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>                <span class="n">new_value</span><span class="o">=</span><span class="n">current_ewma</span><span class="p">,</span>
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>                <span class="n">drift_magnitude</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">current_ewma</span> <span class="o">-</span> <span class="n">new_mean</span><span class="p">),</span>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>                <span class="n">drift_rate</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">prev_ewma</span><span class="p">),</span>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>                <span class="n">significance</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">drift_mag</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span><span class="p">),</span>
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>                <span class="n">recommended_action</span><span class="o">=</span><span class="s2">&quot;recalibrate&quot;</span> <span class="k">if</span> <span class="n">drift_mag</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="k">else</span> <span class="s2">&quot;monitor&quot;</span><span class="p">,</span>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>            <span class="p">)</span>
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_drift_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get summary of all tracked metrics and their drift status.&quot;&quot;&quot;</span>
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">:</span>
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>            <span class="n">summary</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>                <span class="s2">&quot;current_ewma&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ewma</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>                <span class="s2">&quot;running_mean&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_mean</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>                <span class="s2">&quot;sample_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>                <span class="s2">&quot;recent_values&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>            <span class="p">}</span>
<a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>        <span class="k">return</span> <span class="n">summary</span>
</code></pre></div>
<h3 id="class-continuouscalibrationengine">Class: ContinuousCalibrationEngine<a class="headerlink" href="#class-continuouscalibrationengine" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ContinuousCalibrationEngine</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="sd">    Main calibration engine coordinating all calibration components.</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="sd">    The BCI insight: calibration is not a one-time setup.</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="sd">    It is a continuous process running throughout the interaction.</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="sd">    Calibration triggers:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="sd">    1. Session start: Full micro-calibration</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="sd">    2. Every N turns: Drift check on key metrics</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="sd">    3. After significant surprise: Re-evaluate calibration</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="sd">    4. On explicit user correction: Immediate recalibration</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="sd">    Usage:</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="sd">        calibration = ContinuousCalibrationEngine(</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="sd">            weight_engine=weights,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="sd">            prediction_engine=prediction,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="sd">            feedback_engine=feedback,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="sd">        )</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="sd">        # At session start</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="sd">        result = calibration.on_session_start(session_id)</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="sd">        # After each turn</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="sd">        drift = calibration.on_turn_complete(</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="sd">            quality=0.8,</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="sd">            latency_ms=1500,</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="sd">            user_engagement=0.7,</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="sd">        )</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="sd">        # Periodic deep calibration</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="sd">        if turn_count % 10 == 0:</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="sd">            calibration.deep_calibrate()</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>        <span class="n">weight_engine</span><span class="p">:</span> <span class="n">WeightEngine</span><span class="p">,</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>        <span class="n">prediction_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PredictionEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>        <span class="n">feedback_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FeedbackEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>        <span class="n">calibration_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>    <span class="c1"># Turns between drift checks</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>    <span class="p">):</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weight_engine</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span> <span class="o">=</span> <span class="n">prediction_engine</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback</span> <span class="o">=</span> <span class="n">feedback_engine</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">calibration_interval</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session_calibrator</span> <span class="o">=</span> <span class="n">SessionStartCalibrator</span><span class="p">()</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_drift_detector</span> <span class="o">=</span> <span class="n">DriftDetector</span><span class="p">()</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibration_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CalibrationResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_session_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationResult</span><span class="p">:</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a><span class="sd">        Run session-start calibration.</span>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="sd">        &quot;You wake up in the morning - your brain needs to re-learn itself.&quot;</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="n">session_id</span>
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>        <span class="c1"># Get previous snapshots</span>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>        <span class="n">snapshots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_calibrator</span><span class="o">.</span><span class="n">_session_snapshots</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>        <span class="n">previous</span> <span class="o">=</span> <span class="n">snapshots</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">snapshots</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>        <span class="n">older</span> <span class="o">=</span> <span class="n">snapshots</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapshots</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_calibrator</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">,</span> <span class="n">previous</span><span class="p">,</span> <span class="n">older</span>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>        <span class="p">)</span>
<a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>
<a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibration_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">adjustments</span><span class="p">:</span>
<a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>                <span class="sa">f</span><span class="s2">&quot;Session-start calibration: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">adjustments</span><span class="p">)</span><span class="si">}</span><span class="s2"> adjustments, &quot;</span>
<a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>                <span class="sa">f</span><span class="s2">&quot;quality=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">calibration_quality</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a>            <span class="p">)</span>
<a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>
<a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a>
<a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_turn_complete</span><span class="p">(</span>
<a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a>        <span class="n">quality</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a>        <span class="n">latency_ms</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a>        <span class="n">user_engagement</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a>        <span class="n">surprise_magnitude</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a>        <span class="n">task_complexity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]:</span>
<a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a><span class="sd">        Called after each turn to check for drift.</span>
<a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a><span class="sd">        Returns any drift reports detected.</span>
<a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a>        <span class="n">drift_reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a>
<a id="__codelineno-14-96" name="__codelineno-14-96" href="#__codelineno-14-96"></a>        <span class="c1"># Record metrics for drift detection</span>
<a id="__codelineno-14-97" name="__codelineno-14-97" href="#__codelineno-14-97"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-14-98" name="__codelineno-14-98" href="#__codelineno-14-98"></a>            <span class="s2">&quot;response_quality&quot;</span><span class="p">:</span> <span class="n">quality</span><span class="p">,</span>
<a id="__codelineno-14-99" name="__codelineno-14-99" href="#__codelineno-14-99"></a>            <span class="s2">&quot;response_latency_ms&quot;</span><span class="p">:</span> <span class="n">latency_ms</span> <span class="o">/</span> <span class="mf">5000.0</span><span class="p">,</span>  <span class="c1"># Normalize</span>
<a id="__codelineno-14-100" name="__codelineno-14-100" href="#__codelineno-14-100"></a>            <span class="s2">&quot;user_engagement&quot;</span><span class="p">:</span> <span class="n">user_engagement</span><span class="p">,</span>
<a id="__codelineno-14-101" name="__codelineno-14-101" href="#__codelineno-14-101"></a>            <span class="s2">&quot;surprise&quot;</span><span class="p">:</span> <span class="n">surprise_magnitude</span><span class="p">,</span>
<a id="__codelineno-14-102" name="__codelineno-14-102" href="#__codelineno-14-102"></a>            <span class="s2">&quot;task_complexity&quot;</span><span class="p">:</span> <span class="n">task_complexity</span><span class="p">,</span>
<a id="__codelineno-14-103" name="__codelineno-14-103" href="#__codelineno-14-103"></a>        <span class="p">}</span>
<a id="__codelineno-14-104" name="__codelineno-14-104" href="#__codelineno-14-104"></a>
<a id="__codelineno-14-105" name="__codelineno-14-105" href="#__codelineno-14-105"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-14-106" name="__codelineno-14-106" href="#__codelineno-14-106"></a>            <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drift_detector</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-14-107" name="__codelineno-14-107" href="#__codelineno-14-107"></a>            <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
<a id="__codelineno-14-108" name="__codelineno-14-108" href="#__codelineno-14-108"></a>                <span class="n">drift_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<a id="__codelineno-14-109" name="__codelineno-14-109" href="#__codelineno-14-109"></a>
<a id="__codelineno-14-110" name="__codelineno-14-110" href="#__codelineno-14-110"></a>        <span class="c1"># Apply corrective actions for significant drift</span>
<a id="__codelineno-14-111" name="__codelineno-14-111" href="#__codelineno-14-111"></a>        <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">drift_reports</span><span class="p">:</span>
<a id="__codelineno-14-112" name="__codelineno-14-112" href="#__codelineno-14-112"></a>            <span class="k">if</span> <span class="n">report</span><span class="o">.</span><span class="n">recommended_action</span> <span class="o">==</span> <span class="s2">&quot;recalibrate&quot;</span><span class="p">:</span>
<a id="__codelineno-14-113" name="__codelineno-14-113" href="#__codelineno-14-113"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_drift_correction</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<a id="__codelineno-14-114" name="__codelineno-14-114" href="#__codelineno-14-114"></a>
<a id="__codelineno-14-115" name="__codelineno-14-115" href="#__codelineno-14-115"></a>        <span class="k">return</span> <span class="n">drift_reports</span>
<a id="__codelineno-14-116" name="__codelineno-14-116" href="#__codelineno-14-116"></a>
<a id="__codelineno-14-117" name="__codelineno-14-117" href="#__codelineno-14-117"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_drift_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="n">DriftReport</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-14-118" name="__codelineno-14-118" href="#__codelineno-14-118"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a corrective weight adjustment for detected drift.&quot;&quot;&quot;</span>
<a id="__codelineno-14-119" name="__codelineno-14-119" href="#__codelineno-14-119"></a>        <span class="k">if</span> <span class="n">report</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="s2">&quot;response_quality&quot;</span> <span class="ow">and</span> <span class="n">report</span><span class="o">.</span><span class="n">new_value</span> <span class="o">&lt;</span> <span class="n">report</span><span class="o">.</span><span class="n">old_value</span><span class="p">:</span>
<a id="__codelineno-14-120" name="__codelineno-14-120" href="#__codelineno-14-120"></a>            <span class="c1"># Quality declining - increase caution</span>
<a id="__codelineno-14-121" name="__codelineno-14-121" href="#__codelineno-14-121"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;risk_tolerance&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">)</span>
<a id="__codelineno-14-122" name="__codelineno-14-122" href="#__codelineno-14-122"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;speed_vs_quality&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">)</span>
<a id="__codelineno-14-123" name="__codelineno-14-123" href="#__codelineno-14-123"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drift correction: quality declining, reducing risk tolerance&quot;</span><span class="p">)</span>
<a id="__codelineno-14-124" name="__codelineno-14-124" href="#__codelineno-14-124"></a>
<a id="__codelineno-14-125" name="__codelineno-14-125" href="#__codelineno-14-125"></a>        <span class="k">elif</span> <span class="n">report</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="s2">&quot;user_engagement&quot;</span> <span class="ow">and</span> <span class="n">report</span><span class="o">.</span><span class="n">new_value</span> <span class="o">&lt;</span> <span class="n">report</span><span class="o">.</span><span class="n">old_value</span><span class="p">:</span>
<a id="__codelineno-14-126" name="__codelineno-14-126" href="#__codelineno-14-126"></a>            <span class="c1"># Engagement dropping - increase initiative</span>
<a id="__codelineno-14-127" name="__codelineno-14-127" href="#__codelineno-14-127"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;initiative&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<a id="__codelineno-14-128" name="__codelineno-14-128" href="#__codelineno-14-128"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drift correction: engagement dropping, increasing initiative&quot;</span><span class="p">)</span>
<a id="__codelineno-14-129" name="__codelineno-14-129" href="#__codelineno-14-129"></a>
<a id="__codelineno-14-130" name="__codelineno-14-130" href="#__codelineno-14-130"></a>        <span class="k">elif</span> <span class="n">report</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="s2">&quot;response_latency_ms&quot;</span> <span class="ow">and</span> <span class="n">report</span><span class="o">.</span><span class="n">new_value</span> <span class="o">&gt;</span> <span class="n">report</span><span class="o">.</span><span class="n">old_value</span><span class="p">:</span>
<a id="__codelineno-14-131" name="__codelineno-14-131" href="#__codelineno-14-131"></a>            <span class="c1"># Getting slower - shift toward speed</span>
<a id="__codelineno-14-132" name="__codelineno-14-132" href="#__codelineno-14-132"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;speed_vs_quality&quot;</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
<a id="__codelineno-14-133" name="__codelineno-14-133" href="#__codelineno-14-133"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drift correction: latency increasing, shifting toward speed&quot;</span><span class="p">)</span>
<a id="__codelineno-14-134" name="__codelineno-14-134" href="#__codelineno-14-134"></a>
<a id="__codelineno-14-135" name="__codelineno-14-135" href="#__codelineno-14-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_session_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationSnapshot</span><span class="p">:</span>
<a id="__codelineno-14-136" name="__codelineno-14-136" href="#__codelineno-14-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Take an end-of-session snapshot for future calibration.&quot;&quot;&quot;</span>
<a id="__codelineno-14-137" name="__codelineno-14-137" href="#__codelineno-14-137"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_calibrator</span><span class="o">.</span><span class="n">take_snapshot</span><span class="p">(</span>
<a id="__codelineno-14-138" name="__codelineno-14-138" href="#__codelineno-14-138"></a>            <span class="n">weight_engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">,</span>
<a id="__codelineno-14-139" name="__codelineno-14-139" href="#__codelineno-14-139"></a>            <span class="n">prediction_engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span> <span class="ow">or</span> <span class="n">PredictionEngine</span><span class="p">(),</span>
<a id="__codelineno-14-140" name="__codelineno-14-140" href="#__codelineno-14-140"></a>            <span class="n">feedback_engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_feedback</span> <span class="ow">or</span> <span class="n">FeedbackEngine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">),</span>
<a id="__codelineno-14-141" name="__codelineno-14-141" href="#__codelineno-14-141"></a>            <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
<a id="__codelineno-14-142" name="__codelineno-14-142" href="#__codelineno-14-142"></a>            <span class="n">turn_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn_count</span><span class="p">,</span>
<a id="__codelineno-14-143" name="__codelineno-14-143" href="#__codelineno-14-143"></a>        <span class="p">)</span>
<a id="__codelineno-14-144" name="__codelineno-14-144" href="#__codelineno-14-144"></a>
<a id="__codelineno-14-145" name="__codelineno-14-145" href="#__codelineno-14-145"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deep_calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationResult</span><span class="p">:</span>
<a id="__codelineno-14-146" name="__codelineno-14-146" href="#__codelineno-14-146"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-147" name="__codelineno-14-147" href="#__codelineno-14-147"></a><span class="sd">        Run a deep calibration cycle.</span>
<a id="__codelineno-14-148" name="__codelineno-14-148" href="#__codelineno-14-148"></a><span class="sd">        Examines all weight categories and adjusts learning rates.</span>
<a id="__codelineno-14-149" name="__codelineno-14-149" href="#__codelineno-14-149"></a>
<a id="__codelineno-14-150" name="__codelineno-14-150" href="#__codelineno-14-150"></a><span class="sd">        This is more expensive than per-turn drift checking</span>
<a id="__codelineno-14-151" name="__codelineno-14-151" href="#__codelineno-14-151"></a><span class="sd">        and should run every N turns (default: 10).</span>
<a id="__codelineno-14-152" name="__codelineno-14-152" href="#__codelineno-14-152"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-153" name="__codelineno-14-153" href="#__codelineno-14-153"></a>        <span class="n">adjustments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-154" name="__codelineno-14-154" href="#__codelineno-14-154"></a>        <span class="n">drift_reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DriftReport</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-155" name="__codelineno-14-155" href="#__codelineno-14-155"></a>
<a id="__codelineno-14-156" name="__codelineno-14-156" href="#__codelineno-14-156"></a>        <span class="c1"># Check if prediction engine is well-calibrated</span>
<a id="__codelineno-14-157" name="__codelineno-14-157" href="#__codelineno-14-157"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span><span class="p">:</span>
<a id="__codelineno-14-158" name="__codelineno-14-158" href="#__codelineno-14-158"></a>            <span class="n">cal_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span><span class="o">.</span><span class="n">get_calibration_score</span><span class="p">()</span>
<a id="__codelineno-14-159" name="__codelineno-14-159" href="#__codelineno-14-159"></a>            <span class="k">if</span> <span class="n">cal_error</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
<a id="__codelineno-14-160" name="__codelineno-14-160" href="#__codelineno-14-160"></a>                <span class="c1"># Predictions are poor - increase plasticity</span>
<a id="__codelineno-14-161" name="__codelineno-14-161" href="#__codelineno-14-161"></a>                <span class="n">drift_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DriftReport</span><span class="p">(</span>
<a id="__codelineno-14-162" name="__codelineno-14-162" href="#__codelineno-14-162"></a>                    <span class="n">dimension</span><span class="o">=</span><span class="s2">&quot;prediction_calibration&quot;</span><span class="p">,</span>
<a id="__codelineno-14-163" name="__codelineno-14-163" href="#__codelineno-14-163"></a>                    <span class="n">old_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-164" name="__codelineno-14-164" href="#__codelineno-14-164"></a>                    <span class="n">new_value</span><span class="o">=</span><span class="n">cal_error</span><span class="p">,</span>
<a id="__codelineno-14-165" name="__codelineno-14-165" href="#__codelineno-14-165"></a>                    <span class="n">drift_magnitude</span><span class="o">=</span><span class="n">cal_error</span><span class="p">,</span>
<a id="__codelineno-14-166" name="__codelineno-14-166" href="#__codelineno-14-166"></a>                    <span class="n">drift_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-167" name="__codelineno-14-167" href="#__codelineno-14-167"></a>                    <span class="n">significance</span><span class="o">=</span><span class="n">cal_error</span><span class="p">,</span>
<a id="__codelineno-14-168" name="__codelineno-14-168" href="#__codelineno-14-168"></a>                    <span class="n">recommended_action</span><span class="o">=</span><span class="s2">&quot;recalibrate&quot;</span><span class="p">,</span>
<a id="__codelineno-14-169" name="__codelineno-14-169" href="#__codelineno-14-169"></a>                <span class="p">))</span>
<a id="__codelineno-14-170" name="__codelineno-14-170" href="#__codelineno-14-170"></a>
<a id="__codelineno-14-171" name="__codelineno-14-171" href="#__codelineno-14-171"></a>        <span class="c1"># Check behavioral weight entropy (all weights near zero = under-adapted)</span>
<a id="__codelineno-14-172" name="__codelineno-14-172" href="#__codelineno-14-172"></a>        <span class="n">behavioral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">behavioral</span><span class="o">.</span><span class="n">weights</span>
<a id="__codelineno-14-173" name="__codelineno-14-173" href="#__codelineno-14-173"></a>        <span class="n">weight_magnitudes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">behavioral</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<a id="__codelineno-14-174" name="__codelineno-14-174" href="#__codelineno-14-174"></a>        <span class="n">avg_magnitude</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weight_magnitudes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weight_magnitudes</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-14-175" name="__codelineno-14-175" href="#__codelineno-14-175"></a>
<a id="__codelineno-14-176" name="__codelineno-14-176" href="#__codelineno-14-176"></a>        <span class="k">if</span> <span class="n">avg_magnitude</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
<a id="__codelineno-14-177" name="__codelineno-14-177" href="#__codelineno-14-177"></a>            <span class="c1"># System hasn&#39;t adapted enough - might be stuck at defaults</span>
<a id="__codelineno-14-178" name="__codelineno-14-178" href="#__codelineno-14-178"></a>            <span class="n">drift_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DriftReport</span><span class="p">(</span>
<a id="__codelineno-14-179" name="__codelineno-14-179" href="#__codelineno-14-179"></a>                <span class="n">dimension</span><span class="o">=</span><span class="s2">&quot;behavioral_entropy&quot;</span><span class="p">,</span>
<a id="__codelineno-14-180" name="__codelineno-14-180" href="#__codelineno-14-180"></a>                <span class="n">old_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-181" name="__codelineno-14-181" href="#__codelineno-14-181"></a>                <span class="n">new_value</span><span class="o">=</span><span class="n">avg_magnitude</span><span class="p">,</span>
<a id="__codelineno-14-182" name="__codelineno-14-182" href="#__codelineno-14-182"></a>                <span class="n">drift_magnitude</span><span class="o">=</span><span class="mf">0.05</span> <span class="o">-</span> <span class="n">avg_magnitude</span><span class="p">,</span>
<a id="__codelineno-14-183" name="__codelineno-14-183" href="#__codelineno-14-183"></a>                <span class="n">drift_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-14-184" name="__codelineno-14-184" href="#__codelineno-14-184"></a>                <span class="n">significance</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-14-185" name="__codelineno-14-185" href="#__codelineno-14-185"></a>                <span class="n">recommended_action</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="p">,</span>
<a id="__codelineno-14-186" name="__codelineno-14-186" href="#__codelineno-14-186"></a>            <span class="p">))</span>
<a id="__codelineno-14-187" name="__codelineno-14-187" href="#__codelineno-14-187"></a>
<a id="__codelineno-14-188" name="__codelineno-14-188" href="#__codelineno-14-188"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">CalibrationResult</span><span class="p">(</span>
<a id="__codelineno-14-189" name="__codelineno-14-189" href="#__codelineno-14-189"></a>            <span class="n">adjustments</span><span class="o">=</span><span class="n">adjustments</span><span class="p">,</span>
<a id="__codelineno-14-190" name="__codelineno-14-190" href="#__codelineno-14-190"></a>            <span class="n">drift_reports</span><span class="o">=</span><span class="n">drift_reports</span><span class="p">,</span>
<a id="__codelineno-14-191" name="__codelineno-14-191" href="#__codelineno-14-191"></a>            <span class="n">calibration_quality</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">drift_reports</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-14-192" name="__codelineno-14-192" href="#__codelineno-14-192"></a>        <span class="p">)</span>
<a id="__codelineno-14-193" name="__codelineno-14-193" href="#__codelineno-14-193"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibration_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-14-194" name="__codelineno-14-194" href="#__codelineno-14-194"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-14-195" name="__codelineno-14-195" href="#__codelineno-14-195"></a>
<a id="__codelineno-14-196" name="__codelineno-14-196" href="#__codelineno-14-196"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-14-197" name="__codelineno-14-197" href="#__codelineno-14-197"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get calibration engine statistics.&quot;&quot;&quot;</span>
<a id="__codelineno-14-198" name="__codelineno-14-198" href="#__codelineno-14-198"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-14-199" name="__codelineno-14-199" href="#__codelineno-14-199"></a>            <span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">,</span>
<a id="__codelineno-14-200" name="__codelineno-14-200" href="#__codelineno-14-200"></a>            <span class="s2">&quot;turn_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn_count</span><span class="p">,</span>
<a id="__codelineno-14-201" name="__codelineno-14-201" href="#__codelineno-14-201"></a>            <span class="s2">&quot;calibration_cycles&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calibration_history</span><span class="p">),</span>
<a id="__codelineno-14-202" name="__codelineno-14-202" href="#__codelineno-14-202"></a>            <span class="s2">&quot;drift_summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drift_detector</span><span class="o">.</span><span class="n">get_drift_summary</span><span class="p">(),</span>
<a id="__codelineno-14-203" name="__codelineno-14-203" href="#__codelineno-14-203"></a>            <span class="s2">&quot;snapshots_stored&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session_calibrator</span><span class="o">.</span><span class="n">_session_snapshots</span><span class="p">),</span>
<a id="__codelineno-14-204" name="__codelineno-14-204" href="#__codelineno-14-204"></a>        <span class="p">}</span>
</code></pre></div>
<h3 id="integration-points_2">Integration Points<a class="headerlink" href="#integration-points_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Existing File</th>
<th>Integration Point</th>
<th>Change Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>corteX/engine/calibration.py</code></td>
<td>New file</td>
<td>Contains ContinuousCalibrationEngine and supporting classes</td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.__init__()</code></td>
<td>Initialize <code>self.calibration = ContinuousCalibrationEngine(self.weights, self.prediction, self.feedback)</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.__init__()</code></td>
<td>Call <code>self.calibration.on_session_start(self.session_id)</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.run()</code> after step 11</td>
<td>Call <code>self.calibration.on_turn_complete(quality=estimated_quality, latency_ms=latency_ms, user_engagement=..., surprise_magnitude=surprise.surprise_magnitude)</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.run()</code> periodically</td>
<td>Every 10 turns: <code>self.calibration.deep_calibrate()</code></td>
</tr>
<tr>
<td><code>corteX/sdk.py</code></td>
<td><code>Session.close()</code></td>
<td>Call <code>self.calibration.on_session_end()</code> to save snapshot</td>
</tr>
<tr>
<td><code>corteX/engine/plasticity.py</code></td>
<td><code>CriticalPeriodModulator</code></td>
<td>Calibration can reset or extend critical period based on drift magnitude</td>
</tr>
</tbody>
</table>
<h3 id="test-scenarios-10_2">Test Scenarios (10+)<a class="headerlink" href="#test-scenarios-10_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>First session</strong>: No previous snapshots. Calibration is a no-op with default quality.</li>
<li><strong>Session continuity</strong>: Save snapshot at session end. Verify it is loaded at next session start.</li>
<li><strong>Drift momentum</strong>: User's verbosity preference trending upward across sessions. Session-start calibration should continue the trend.</li>
<li><strong>Regression to mean</strong>: Weight at extreme (0.9) with no drift trend. Should regress slightly toward 0.0.</li>
<li><strong>Quality drift detection</strong>: Agent quality drops for 5 consecutive turns. DriftDetector fires.</li>
<li><strong>Engagement drift correction</strong>: Engagement drops below control limit. Initiative weight should increase.</li>
<li><strong>Latency drift</strong>: Response times increasing. speed_vs_quality should shift.</li>
<li><strong>Deep calibration low entropy</strong>: All weights near 0. Should detect under-adaptation.</li>
<li><strong>Prediction accuracy decline</strong>: Calibration score &gt; 0.4 last session. Should flag for recalibration.</li>
<li><strong>No drift</strong>: Stable metrics for 20 turns. No drift reports should be generated.</li>
<li><strong>Correction trigger</strong>: User sends explicit correction. Immediate recalibration path.</li>
<li><strong>Multiple sessions</strong>: Run 5 sessions, verify snapshot chain and trend detection across them.</li>
<li><strong>EWMA control chart</strong>: Inject a step-change in metrics. Verify detection within 3-5 turns.</li>
</ol>
<h3 id="edge-cases-and-failure-modes_2">Edge Cases and Failure Modes<a class="headerlink" href="#edge-cases-and-failure-modes_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Missing snapshots</strong>: Storage backend loses snapshots. Graceful fallback to no calibration.</li>
<li><strong>Rapid session cycling</strong>: Many very short sessions. Snapshots may not have enough data. Solution: minimum turn count for snapshot.</li>
<li><strong>Contradictory drift</strong>: Quality improving but engagement dropping. Each dimension calibrated independently.</li>
<li><strong>EWMA cold start</strong>: First few data points produce unstable EWMA. Solution: require minimum sample count before checking control limits.</li>
</ul>
<hr />
<h2 id="p2-functional-columns">P2: Functional Columns<a class="headerlink" href="#p2-functional-columns" title="Permanent link">&para;</a></h2>
<h3 id="high-level-design">High-Level Design<a class="headerlink" href="#high-level-design" title="Permanent link">&para;</a></h3>
<blockquote>
<p>"In the primary visual cortex there are functional columns, meaning 10,000 cells now fire
when I show you this angle." - Prof. Segev, Lecture 3</p>
</blockquote>
<p>A functional column bundles tools + models + behavioral weights into a coherent unit that
specializes in a task domain. Columns compete for activation based on the incoming request.</p>
<p><strong>Proposed Architecture:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">FunctionalColumn</span><span class="p">:</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A coherent processing bundle.&quot;&quot;&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">column_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span>                         <span class="c1"># e.g., &quot;coding&quot;, &quot;research&quot;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">preferred_tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">preferred_model</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="n">behavioral_overrides</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>  <span class="c1"># Override weights when this column is active</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="n">activation_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">specialization_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c1"># How specialized this column has become</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
</code></pre></div>
<p><strong>Key Ideas:</strong>
- Columns are learned, not manually defined (though initial columns can be seeded)
- Column competition: multiple columns score the request, highest activation wins
- Winner-take-all with inhibition: winning column suppresses others (lateral inhibition)
- Over time, columns specialize through Hebbian learning
- New columns can emerge when existing ones fail to cover a task type</p>
<p><strong>Relationship to P0/P1:</strong>
- Proactive Prediction predicts which column will activate next (pre-warm the column)
- Cross-Modal Association creates links between columns (coding column activates partial debugging column)
- Continuous Calibration recalibrates column activation thresholds</p>
<p><strong>Dependencies:</strong>
- Requires Population Coding (columns are scored by population decoder)
- Requires Adaptation (column activation patterns habituate)
- Requires the full weight engine API</p>
<h3 id="file-cortexenginecolumnspy-future">File: <code>corteX/engine/columns.py</code> (Future)<a class="headerlink" href="#file-cortexenginecolumnspy-future" title="Permanent link">&para;</a></h3>
<hr />
<h2 id="p2-attentional-filter">P2: Attentional Filter<a class="headerlink" href="#p2-attentional-filter" title="Permanent link">&para;</a></h2>
<h3 id="high-level-design_1">High-Level Design<a class="headerlink" href="#high-level-design_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>"We are very unconscious creatures... what I describe to you are things I AM conscious of,
and that's only a small part of brain activity." - Prof. Segev, Lecture 3</p>
</blockquote>
<p>The change blindness experiment demonstrates that we process far less than we think.
The Attentional Filter implements a "subconscious" processing tier that handles routine
patterns without consuming full orchestrator resources.</p>
<p><strong>Proposed Architecture:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AttentionalFilter</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="sd">    Two-tier processing:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="sd">    1. Subconscious: Fast pattern-matched responses for routine queries</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="sd">    2. Conscious: Full orchestrator pipeline for novel/complex queries</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns &#39;subconscious&#39; or &#39;conscious&#39;.&quot;&quot;&quot;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="o">...</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">previous_context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">current_context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute only what changed between turns.&quot;&quot;&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="o">...</span>
</code></pre></div>
<p><strong>Key Ideas:</strong>
- Delta processing: Only feed the orchestrator what CHANGED between turns
- Routine routing: Queries matching established patterns get fast-tracked
- Novelty detection: Novel requests trigger full "conscious" processing
- Reduces token consumption by 30-50% for habituated conversation patterns</p>
<p><strong>Relationship to P0/P1:</strong>
- Uses Adaptation's habituation system to determine what's "routine"
- Proactive Prediction feeds the filter: predicted queries can be pre-classified
- Continuous Calibration tracks what percentage of queries go to each tier</p>
<p><strong>Dependencies:</strong>
- Requires Adaptation engine (habituation detection)
- Requires Population Coding (classify novelty via population vote)</p>
<h3 id="file-cortexengineattentionpy-future">File: <code>corteX/engine/attention.py</code> (Future)<a class="headerlink" href="#file-cortexengineattentionpy-future" title="Permanent link">&para;</a></h3>
<hr />
<h2 id="cross-pattern-interactions">Cross-Pattern Interactions<a class="headerlink" href="#cross-pattern-interactions" title="Permanent link">&para;</a></h2>
<h3 id="1-proactive-prediction-feeds-adaptation">1. Proactive Prediction feeds Adaptation<a class="headerlink" href="#1-proactive-prediction-feeds-adaptation" title="Permanent link">&para;</a></h3>
<p>The prediction system generates a continuous stream of predictions. If the same prediction
is made repeatedly (user always follows coding with debugging), the Adaptation engine should
habituate to this prediction -- reducing the "surprise" signal when it proves correct.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>ProactivePredictionEngine.predict_next_turn()
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>  -&gt; prediction_type = &quot;debugging&quot; (for the 10th time)
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  -&gt; AdaptationFilter.process(&quot;prediction:debugging&quot;, confidence)
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  -&gt; Returns adaptation_weight = 0.1 (habituated, low novelty)
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>But if prediction is WRONG (user sends &quot;research&quot; instead):
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>  -&gt; AdaptationFilter detects CHANGE
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>  -&gt; adaptation_weight = 2.0 (novelty bonus!)
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>  -&gt; Triggers increased learning signal via SurpriseSignal
</code></pre></div>
<p><strong>Integration code (in Session.run()):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># After proactive prediction</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proactive</span><span class="o">.</span><span class="n">predict_next_turn</span><span class="p">()</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">adapted_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptation</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="sa">f</span><span class="s2">&quot;proactive:</span><span class="si">{</span><span class="n">prediction</span><span class="o">.</span><span class="n">predicted_task_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">prediction</span><span class="o">.</span><span class="n">confidence</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># If adapted_pred is None (habituated prediction), reduce pre-warming priority</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="c1"># If adapted_pred.is_novel, amplify pre-warming and increase plasticity</span>
</code></pre></div></p>
<h3 id="2-cross-modal-association-interacts-with-population-coding">2. Cross-Modal Association interacts with Population Coding<a class="headerlink" href="#2-cross-modal-association-interacts-with-population-coding" title="Permanent link">&para;</a></h3>
<p>Echo updates from cross-modal transfer should appear as weak votes in the
PopulationDecoder when making tool/model selection decisions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>CrossModalAssociator.propagate_learning(&quot;coding&quot;, ...)
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>  -&gt; Generates echo to &quot;debugging&quot; domain
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  -&gt; PopulationToolSelector receives echo as a weak vote:
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>     decoder.add_vote(&quot;cross_modal_echo&quot;, echo_strength, confidence=0.2)
</code></pre></div>
<p>This means cross-modal learning doesn't override population-level decisions --
it adds a gentle bias that the population can accept or reject.</p>
<p><strong>Integration code (in PopulationToolSelector.select()):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># When scoring a tool for a domain, add cross-modal echoes as weak votes</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">echo_score</span> <span class="o">=</span> <span class="n">associator</span><span class="o">.</span><span class="n">get_echo_influence</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">if</span> <span class="n">echo_score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">decoder</span><span class="o">.</span><span class="n">add_vote</span><span class="p">(</span><span class="s2">&quot;cross_modal&quot;</span><span class="p">,</span> <span class="n">echo_score</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="3-continuous-calibration-affects-plasticity">3. Continuous Calibration affects Plasticity<a class="headerlink" href="#3-continuous-calibration-affects-plasticity" title="Permanent link">&para;</a></h3>
<p>When the calibration engine detects significant drift, it should adjust the
plasticity system's learning rates and critical period modulator.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ContinuousCalibrationEngine.on_turn_complete(...)
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  -&gt; DriftDetector fires: quality declining
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>  -&gt; PlasticityManager gets signal to increase learning rate temporarily
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>  -&gt; CriticalPeriodModulator: if drift is severe, re-open critical period
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>Specifically:
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>  if drift.significance &gt; 0.7:
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>    plasticity.critical_period.reset()  # Re-enter critical period
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>    plasticity._homeostasis_interval = 5  # More frequent homeostasis
</code></pre></div>
<p><strong>Integration code (in PlasticityManager):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_drift_detected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drift_report</span><span class="p">:</span> <span class="n">DriftReport</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust plasticity parameters in response to detected drift.&quot;&quot;&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="k">if</span> <span class="n">drift_report</span><span class="o">.</span><span class="n">significance</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="c1"># Severe drift: re-enter critical period for faster adaptation</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">critical_period</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_homeostasis_interval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_homeostasis_interval</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="k">elif</span> <span class="n">drift_report</span><span class="o">.</span><span class="n">significance</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>        <span class="c1"># Moderate drift: increase learning rates temporarily</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">lr</span><span class="o">.</span><span class="n">behavioral</span> <span class="o">*=</span> <span class="mf">1.2</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">lr</span><span class="o">.</span><span class="n">tool_preference</span> <span class="o">*=</span> <span class="mf">1.2</span>
</code></pre></div></p>
<h3 id="4-prediction-calibration-feedback-loop">4. Prediction-Calibration Feedback Loop<a class="headerlink" href="#4-prediction-calibration-feedback-loop" title="Permanent link">&para;</a></h3>
<p>The calibration engine monitors prediction accuracy. When accuracy drops,
it signals the proactive prediction engine to widen its prediction distribution
(less confident predictions, consider more alternatives).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ContinuousCalibrationEngine.deep_calibrate()
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>  -&gt; prediction accuracy = 0.3 (poor)
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>  -&gt; ProactivePredictionEngine adjusts:
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>     - Reduce chain cache minimum_occurrences (consider rarer patterns)
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>     - Increase trajectory model&#39;s unigram_weight (less reliance on specific sequences)
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>     - Lower pre-warming confidence threshold
</code></pre></div>
<h3 id="5-adaptation-feeds-cross-modal-association">5. Adaptation feeds Cross-Modal Association<a class="headerlink" href="#5-adaptation-feeds-cross-modal-association" title="Permanent link">&para;</a></h3>
<p>When the Adaptation engine detects that a signal has been habituated in one domain,
the Cross-Modal Associator should note this. A habituated pattern in domain A should
not be re-introduced via echo from a related domain B.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>AdaptationFilter: signal &quot;brevity&quot; habituated in &quot;coding&quot; domain
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>CrossModalAssociator: suppress echo of &quot;brevity&quot; signal to &quot;debugging&quot; domain
</code></pre></div>
<hr />
<h2 id="new-brain-pattern-proposals">New Brain Pattern Proposals<a class="headerlink" href="#new-brain-pattern-proposals" title="Permanent link">&para;</a></h2>
<h3 id="proposal-1-neuromodulatory-system-dopamine-norepinephrine-serotonin">Proposal 1: Neuromodulatory System (Dopamine / Norepinephrine / Serotonin)<a class="headerlink" href="#proposal-1-neuromodulatory-system-dopamine-norepinephrine-serotonin" title="Permanent link">&para;</a></h3>
<p><strong>Neuroscience Basis:</strong>
The brain's behavior is globally modulated by diffuse neuromodulatory systems:
- <strong>Dopamine</strong>: Reward prediction error, motivation, reinforcement learning
- <strong>Norepinephrine</strong>: Arousal, urgency, fight-or-flight, attentional focus
- <strong>Serotonin</strong>: Patience, long-term planning, impulse control</p>
<p>These are NOT specific to any neural circuit -- they modulate the ENTIRE brain's behavior.
A dopamine surge makes ALL learning stronger. Norepinephrine makes ALL processing faster
but less careful. Serotonin makes ALL decisions more patient.</p>
<p><strong>SDK Pattern: <code>NeuromodulatorSystem</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">NeuromodulatoryState</span><span class="p">:</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Global modulatory state affecting all engine components.&quot;&quot;&quot;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">dopamine</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>      <span class="c1"># 0=apathetic, 1=highly motivated</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">norepinephrine</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># 0=calm, 1=urgent/aroused</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="n">serotonin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1"># 0=impulsive, 1=patient/planful</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">NeuromodulatorSystem</span><span class="p">:</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="sd">    Global modulator that affects ALL engine components simultaneously.</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="sd">    Dopamine effects:</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="sd">    - High: Increase learning rates, increase risk tolerance, increase initiative</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="sd">    - Low: Decrease learning rates, decrease exploration, prefer safe options</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="sd">    Norepinephrine effects:</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="sd">    - High: Favor speed over quality, reduce explanation depth, increase autonomy</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="sd">    - Low: Favor quality over speed, increase verification, more cautious</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="sd">    Serotonin effects:</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="sd">    - High: Favor long-term planning, increase patience, prefer thorough approaches</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="sd">    - Low: Favor immediate gratification, shortcuts, impulsive tool selection</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_from_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surprise</span><span class="p">:</span> <span class="n">SurpriseSignal</span><span class="p">,</span> <span class="n">feedback</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FeedbackSignal</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update neuromodulatory state based on current context.&quot;&quot;&quot;</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>        <span class="c1"># Positive surprise -&gt; dopamine burst</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>        <span class="c1"># User frustration -&gt; norepinephrine spike</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>        <span class="c1"># Successful long task -&gt; serotonin increase</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>        <span class="o">...</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_modulation_multipliers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get multipliers for all engine parameters.&quot;&quot;&quot;</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>        <span class="c1"># Returns: learning_rate_mult, speed_quality_bias, planning_depth_mult, etc.</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>        <span class="o">...</span>
</code></pre></div>
<p><strong>Rationale:</strong> Currently, corteX modulates individual components independently. A neuromodulatory
system provides coherent global state changes. When the user is frustrated (norepinephrine spike),
EVERYTHING should shift: faster responses, less explanation, more direct action. This creates
the kind of emergent coherent behavior seen in biological systems.</p>
<p><strong>Priority:</strong> P1 -- Medium complexity, high impact on behavioral coherence.</p>
<h3 id="proposal-2-inhibitory-interneurons-lateral-inhibition-winner-take-all">Proposal 2: Inhibitory Interneurons (Lateral Inhibition / Winner-Take-All)<a class="headerlink" href="#proposal-2-inhibitory-interneurons-lateral-inhibition-winner-take-all" title="Permanent link">&para;</a></h3>
<p><strong>Neuroscience Basis:</strong>
The brain is not all excitation. About 20% of cortical neurons are inhibitory.
Lateral inhibition creates contrast enhancement: the strongest signal suppresses
nearby weaker signals. This is how the brain achieves sharp decisions from
distributed noisy representations.</p>
<p><strong>SDK Pattern: <code>LateralInhibitionNetwork</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LateralInhibitionNetwork</span><span class="p">:</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="sd">    When multiple tools/models/strategies compete for selection,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="sd">    the winning candidate actively INHIBITS the runners-up.</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="sd">    This prevents the &quot;tyranny of small differences&quot; where</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="sd">    two nearly-equal candidates oscillate. Once a winner emerges,</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="sd">    it suppresses alternatives for this turn.</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="sd">    Also implements:</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="sd">    - Surround inhibition: Similar tools suppress each other more than</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="sd">      dissimilar tools (code_interpreter suppresses code_sandbox more</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="sd">      than it suppresses web_search)</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="sd">    - Rebound inhibition: After prolonged suppression, a tool gets a</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="sd">      brief excitatory rebound (prevents permanent neglect)</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidates</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="sd">        Run winner-take-all competition.</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="sd">        Returns: (winner, inhibited_scores)</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>        <span class="o">...</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_surround_inhibition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">winner</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">similarity_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inhibit similar candidates more than dissimilar ones.&quot;&quot;&quot;</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>        <span class="o">...</span>
</code></pre></div>
<p><strong>Rationale:</strong> The current PopulationDecoder aggregates votes but doesn't implement
competitive dynamics. Adding lateral inhibition creates sharper, more decisive tool
selection and prevents the system from "waffling" between similar alternatives.</p>
<p><strong>Priority:</strong> P2 -- Medium complexity, medium impact. Depends on Population Coding and Functional Columns.</p>
<h3 id="proposal-3-place-cells-grid-cells-cognitive-map-of-task-space">Proposal 3: Place Cells / Grid Cells (Cognitive Map of Task Space)<a class="headerlink" href="#proposal-3-place-cells-grid-cells-cognitive-map-of-task-space" title="Permanent link">&para;</a></h3>
<p><strong>Neuroscience Basis:</strong>
Place cells in the hippocampus fire when the organism is at a specific location.
Grid cells in the entorhinal cortex create a hexagonal coordinate system for navigation.
Together, they form a cognitive map that enables spatial reasoning: "Where am I?
Where have I been? How do I get to the goal?"</p>
<p>Recent research (Behrens et al., 2018) shows these systems also encode abstract
cognitive spaces -- not just physical locations. The brain navigates "concept space"
using the same neural machinery as physical space.</p>
<p><strong>SDK Pattern: <code>CognitiveNavigator</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">TaskSpacePosition</span><span class="p">:</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent&#39;s current position in abstract task space.&quot;&quot;&quot;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="n">coordinates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>   <span class="c1"># N-dimensional embedding</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="n">complexity</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">progress</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="n">nearest_landmarks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Known successful positions</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">CognitiveNavigator</span><span class="p">:</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="sd">    Navigates the abstract space of task types, user states, and agent capabilities.</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="sd">    Place cells = specific task-state configurations that the agent recognizes</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="sd">    Grid cells = a coordinate system for interpolating between known states</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="sd">    Enables:</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="sd">    1. &quot;Where am I?&quot; - Current position in task space</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="sd">    2. &quot;Have I been here before?&quot; - Episodic recall (connects to MemoryFabric)</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="sd">    3. &quot;What&#39;s the shortest path to the goal?&quot; - Planning via spatial analogy</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="sd">    4. &quot;I&#39;m lost&quot; - Detection of being in an unknown region of task space</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="sd">    The cognitive map is built incrementally:</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="sd">    - Each successful task completion places a &quot;landmark&quot; in task space</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="sd">    - Navigation between landmarks uses learned shortcuts</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="sd">    - Unknown regions trigger exploration behavior (increased creativity weight)</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">locate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TaskSpacePosition</span><span class="p">:</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine current position in task space.&quot;&quot;&quot;</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>        <span class="o">...</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plan_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">:</span> <span class="n">TaskSpacePosition</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plan a sequence of intermediate task-states to reach the goal.&quot;&quot;&quot;</span>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>        <span class="o">...</span>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Am I in an unmapped region of task space?&quot;&quot;&quot;</span>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>        <span class="o">...</span>
</code></pre></div>
<p><strong>Rationale:</strong> The current GoalTracker tracks linear progress (0% to 100%), but real
problem-solving is spatial -- you navigate between states, backtrack, take shortcuts.
A cognitive map enables the agent to reason about WHERE it is in the problem space,
detect when it's "lost," and find paths through known territory. This is especially
valuable for multi-step tasks where the linear progress model breaks down.</p>
<p><strong>Priority:</strong> P3 -- High complexity, high impact. Depends on Memory Fabric, GoalTracker, and Episodic Memory.</p>
<h3 id="proposal-4-mirror-neuron-system-learning-from-observation">Proposal 4: Mirror Neuron System (Learning from Observation)<a class="headerlink" href="#proposal-4-mirror-neuron-system-learning-from-observation" title="Permanent link">&para;</a></h3>
<p><strong>Neuroscience Basis:</strong>
Mirror neurons fire both when an organism performs an action AND when it observes
another organism performing the same action. They enable learning by imitation
and understanding others' intentions.</p>
<p><strong>SDK Pattern: <code>MirrorLearningSystem</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MirrorLearningSystem</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="sd">    Learn from observing OTHER agents or sessions.</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="sd">    When Agent A successfully solves a task, Agent B can &quot;mirror&quot;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="sd">    the successful strategy without having experienced it directly.</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="sd">    Enables:</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="sd">    - Multi-agent knowledge sharing within a deployment</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="sd">    - Learning from demonstrated examples (few-shot from traces)</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="sd">    - Transfer learning between agents serving different users</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="sd">    The mirror signal is weaker than direct experience (like</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="sd">    cross-modal echo), but provides a bootstrap mechanism.</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="o">...</span>
</code></pre></div>
<p><strong>Rationale:</strong> In multi-agent deployments, each agent currently learns independently.
Mirror neurons enable agents to learn from each other's successes, dramatically
accelerating adaptation. This connects to the Tier 4 (Global) feedback system
but operates at the local deployment level.</p>
<p><strong>Priority:</strong> P3 -- Medium complexity, high impact for multi-agent deployments. Depends on Episodic Memory and Cross-Modal Association.</p>
<hr />
<h2 id="implementation-roadmap">Implementation Roadmap<a class="headerlink" href="#implementation-roadmap" title="Permanent link">&para;</a></h2>
<h3 id="phase-1-p0-proactive-prediction">Phase 1: P0 Proactive Prediction<a class="headerlink" href="#phase-1-p0-proactive-prediction" title="Permanent link">&para;</a></h3>
<p><strong>Estimated effort:</strong> 3-4 days
<strong>Files modified:</strong> <code>corteX/engine/prediction.py</code>, <code>corteX/sdk.py</code>
<strong>Dependencies:</strong> None (builds on existing PredictionEngine)
<strong>Tests:</strong> <code>tests/test_proactive_prediction.py</code> (13+ test cases)</p>
<h3 id="phase-2-p1-cross-modal-association">Phase 2: P1 Cross-Modal Association<a class="headerlink" href="#phase-2-p1-cross-modal-association" title="Permanent link">&para;</a></h3>
<p><strong>Estimated effort:</strong> 2-3 days
<strong>Files created:</strong> <code>corteX/engine/association.py</code>
<strong>Files modified:</strong> <code>corteX/engine/plasticity.py</code>, <code>corteX/sdk.py</code>
<strong>Dependencies:</strong> Existing PlasticityManager, WeightEngine
<strong>Tests:</strong> <code>tests/test_association.py</code> (13+ test cases)</p>
<h3 id="phase-3-p1-continuous-calibration">Phase 3: P1 Continuous Calibration<a class="headerlink" href="#phase-3-p1-continuous-calibration" title="Permanent link">&para;</a></h3>
<p><strong>Estimated effort:</strong> 2-3 days
<strong>Files created:</strong> <code>corteX/engine/calibration.py</code>
<strong>Files modified:</strong> <code>corteX/sdk.py</code>
<strong>Dependencies:</strong> PredictionEngine, FeedbackEngine, WeightEngine
<strong>Tests:</strong> <code>tests/test_calibration.py</code> (13+ test cases)</p>
<h3 id="phase-4-cross-pattern-integration">Phase 4: Cross-Pattern Integration<a class="headerlink" href="#phase-4-cross-pattern-integration" title="Permanent link">&para;</a></h3>
<p><strong>Estimated effort:</strong> 2 days
<strong>Files modified:</strong> Multiple engine files
<strong>Dependencies:</strong> All P0/P1 patterns complete
<strong>Tests:</strong> <code>tests/test_cross_pattern.py</code> (integration tests)</p>
<h3 id="phase-5-p2-patterns-future">Phase 5: P2 Patterns (Future)<a class="headerlink" href="#phase-5-p2-patterns-future" title="Permanent link">&para;</a></h3>
<p><strong>Estimated effort:</strong> 5-7 days total
<strong>Dependencies:</strong> All P0/P1 patterns complete</p>
<hr />
<h2 id="mathematical-model-summary">Mathematical Model Summary<a class="headerlink" href="#mathematical-model-summary" title="Permanent link">&para;</a></h2>
<h3 id="proactive-prediction">Proactive Prediction<a class="headerlink" href="#proactive-prediction" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Formula</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>P(next) = w1<em>P_uni + w2</em>P_bi + w3*P_tri</td>
<td>Blended n-gram prediction</td>
</tr>
<tr>
<td>confidence(chain) = n/(n+k) * success_rate * decay</td>
<td>Bayesian chain confidence</td>
</tr>
<tr>
<td>H = -sum(p * log2(p))</td>
<td>Trajectory entropy</td>
</tr>
<tr>
<td>decay = exp(-0.693 * age / halflife)</td>
<td>Time-based chain decay</td>
</tr>
</tbody>
</table>
<h3 id="cross-modal-association">Cross-Modal Association<a class="headerlink" href="#cross-modal-association" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Formula</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>echo_delta = delta * similarity * echo_decay</td>
<td>Echo transfer strength</td>
</tr>
<tr>
<td>sim = alpha<em>prior + (1-alpha)</em>learned</td>
<td>Blended similarity</td>
</tr>
<tr>
<td>sim_learned = co_occ/(count_a+count_b)*2 * success/(success+failures+k)</td>
<td>Learned similarity</td>
</tr>
</tbody>
</table>
<h3 id="continuous-calibration">Continuous Calibration<a class="headerlink" href="#continuous-calibration" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Formula</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>EWMA_t = lambda<em>x_t + (1-lambda)</em>EWMA_{t-1}</td>
<td>Exponentially weighted moving average</td>
</tr>
<tr>
<td>UCL = mean + L<em>sigma</em>sqrt(lambda/(2-lambda))</td>
<td>Upper control limit</td>
</tr>
<tr>
<td>w_start = w_end + momentum*drift (if |drift| &gt; threshold)</td>
<td>Session-start momentum</td>
</tr>
<tr>
<td>w_start = w_end<em>(1-r) + w_prior</em>r (otherwise)</td>
<td>Session-start regression</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="appendix-existing-engine-summary">Appendix: Existing Engine Summary<a class="headerlink" href="#appendix-existing-engine-summary" title="Permanent link">&para;</a></h2>
<p>For reference, the implemented engine modules and their brain analogues:</p>
<table>
<thead>
<tr>
<th>Module</th>
<th>Brain Analogue</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr>
<td>WeightEngine (7 categories)</td>
<td>Synaptic weights across brain regions</td>
<td><code>engine/weights.py</code></td>
</tr>
<tr>
<td>PredictionEngine (reactive)</td>
<td>Cerebellum + predictive coding</td>
<td><code>engine/prediction.py</code></td>
</tr>
<tr>
<td>PlasticityManager</td>
<td>Synaptic plasticity (LTP/LTD/Hebbian)</td>
<td><code>engine/plasticity.py</code></td>
</tr>
<tr>
<td>FeedbackEngine (4 tiers)</td>
<td>Amygdala/Hippocampus/PFC/Collective</td>
<td><code>engine/feedback.py</code></td>
</tr>
<tr>
<td>AdaptationFilter</td>
<td>Sensory adaptation (Meissner/Merkel)</td>
<td><code>engine/adaptation.py</code></td>
</tr>
<tr>
<td>PopulationDecoder</td>
<td>Motor cortex population coding</td>
<td><code>engine/population.py</code></td>
</tr>
<tr>
<td>GoalTracker</td>
<td>ACC + Hippocampus (deja vu)</td>
<td><code>engine/goal_tracker.py</code></td>
</tr>
<tr>
<td>MemoryFabric</td>
<td>Working/Episodic/Semantic memory</td>
<td><code>engine/memory.py</code></td>
</tr>
<tr>
<td>Orchestrator</td>
<td>Central nervous system routing</td>
<td><code>runtime/orchestrator.py</code></td>
</tr>
</tbody>
</table>
<p>With the P0/P1 additions, the engine gains:</p>
<table>
<thead>
<tr>
<th>New Module</th>
<th>Brain Analogue</th>
<th>File</th>
</tr>
</thead>
<tbody>
<tr>
<td>ProactivePredictionEngine</td>
<td>Cortical prediction (goalkeeper)</td>
<td><code>engine/prediction.py</code> (enhanced)</td>
</tr>
<tr>
<td>CrossModalAssociator</td>
<td>Cross-modal integration (touch-&gt;vision)</td>
<td><code>engine/association.py</code> (new)</td>
</tr>
<tr>
<td>ContinuousCalibrationEngine</td>
<td>BCI adaptive algorithm</td>
<td><code>engine/calibration.py</code> (new)</td>
</tr>
</tbody>
</table>
<hr />
<p><em>"This machine imagines all the time. Sometimes it succeeds in imagining well,
and if not, it updates its imagination and works like this all the time."</em>
<em>-- Prof. Idan Segev</em></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>